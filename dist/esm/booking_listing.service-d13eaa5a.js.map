{"file":"booking_listing.service-d13eaa5a.js","mappings":"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","names":["moment"],"sources":["src/stores/booking_listing.store.ts","src/services/booking_listing.service.ts"],"sourcesContent":["import { IExposedBookingsCriteria } from '@/models/IrBookingListing';\r\nimport { Booking } from '@/models/booking.dto';\r\nimport { createStore } from '@stencil/store';\r\nimport moment from 'moment';\r\n\r\nexport interface IBookingListingStore extends IExposedBookingsCriteria {\r\n  token: string;\r\n  userSelection: IUserListingSelection;\r\n  bookings: Booking[];\r\n  download_url: string | null;\r\n  rowCount: number;\r\n}\r\nexport interface IUserListingSelection {\r\n  channel: string;\r\n  property_id: number;\r\n  filter_type: number;\r\n  from: string;\r\n  to: string;\r\n  name: string;\r\n  book_nbr: string;\r\n  booking_status: string;\r\n  affiliate_id: 0;\r\n  is_mpo_managed: false;\r\n  is_mpo_used: false;\r\n  is_for_mobile: false;\r\n  is_combined_view: false;\r\n  start_row: number;\r\n  end_row: number;\r\n  total_count: number;\r\n  is_to_export: boolean;\r\n}\r\n\r\nconst initialState: IBookingListingStore = {\r\n  channels: [],\r\n  settlement_methods: [],\r\n  statuses: [],\r\n  types: [],\r\n  token: '',\r\n  rowCount: 10,\r\n  bookings: [],\r\n  userSelection: {\r\n    from: moment().add(-7, 'days').format('YYYY-MM-DD'),\r\n    to: moment().format('YYYY-MM-DD'),\r\n    channel: '',\r\n    property_id: null,\r\n    start_row: 0,\r\n    end_row: 20,\r\n    total_count: 0,\r\n    filter_type: null,\r\n    name: '',\r\n    book_nbr: '',\r\n    booking_status: '',\r\n    affiliate_id: 0,\r\n    is_mpo_managed: false,\r\n    is_mpo_used: false,\r\n    is_for_mobile: false,\r\n    is_combined_view: false,\r\n    is_to_export: false,\r\n  },\r\n  download_url: null,\r\n};\r\n\r\nexport const { state: booking_listing, onChange: onBookingListingChange } = createStore<IBookingListingStore>(initialState);\r\nexport function initializeUserSelection() {\r\n  //booking_listing.channels[0].name\r\n  booking_listing.userSelection = {\r\n    ...booking_listing.userSelection,\r\n    channel: '',\r\n    booking_status: booking_listing.statuses[0].code,\r\n    filter_type: booking_listing.types[0].id,\r\n    book_nbr: '',\r\n    name: '',\r\n    from: moment().add(-7, 'days').format('YYYY-MM-DD'),\r\n    to: moment().format('YYYY-MM-DD'),\r\n    start_row: 0,\r\n    end_row: booking_listing.rowCount,\r\n  };\r\n}\r\nexport function updateUserSelection(key: keyof IUserListingSelection, value: any) {\r\n  booking_listing.userSelection = {\r\n    ...booking_listing.userSelection,\r\n    [key]: value,\r\n  };\r\n}\r\nexport default booking_listing;\r\n","import { Token } from '@/models/Token';\r\nimport booking_listing, { IUserListingSelection, initializeUserSelection } from '@/stores/booking_listing.store';\r\nimport axios from 'axios';\r\n\r\nexport class BookingListingService extends Token {\r\n  public async getExposedBookingsCriteria(property_id: number) {\r\n    const token = this.getToken();\r\n    if (!token) {\r\n      throw new Error('Invalid token');\r\n    }\r\n    const { data } = await axios.post(`/Get_Exposed_Bookings_Criteria?Ticket=${token}`, {\r\n      property_id,\r\n    });\r\n\r\n    const result = data.My_Result;\r\n\r\n    booking_listing.channels = result.channels;\r\n    booking_listing.settlement_methods = result.settlement_methods;\r\n    booking_listing.statuses = result.statuses;\r\n    booking_listing.types = result.types;\r\n    initializeUserSelection();\r\n  }\r\n\r\n  public async getExposedBookings(params: IUserListingSelection) {\r\n    const token = this.getToken();\r\n    if (!token) {\r\n      throw new Error('Invalid token');\r\n    }\r\n    const { data } = await axios.post(`/Get_Exposed_Bookings?Ticket=${token}`, params);\r\n    const result = data.My_Result;\r\n    const header = data.My_Params_Get_Exposed_Bookings;\r\n    booking_listing.bookings = [...result];\r\n    booking_listing.userSelection = {\r\n      ...booking_listing.userSelection,\r\n      total_count: header.total_count,\r\n    };\r\n    booking_listing.download_url = header.exported_data_url;\r\n  }\r\n  public async removeExposedBooking(booking_nbr: string, is_to_revover: boolean) {\r\n    const token = this.getToken();\r\n    if (!token) {\r\n      throw new Error('Invalid token');\r\n    }\r\n    await axios.post(`/Remove_Exposed_Booking?Ticket=${token}`, {\r\n      booking_nbr,\r\n      is_to_revover,\r\n    });\r\n  }\r\n}\r\n"],"version":3}