{"version":3,"file":"ir-listing-modal.js","sourceRoot":"","sources":["../../../../src/components/ir-booking-listing/ir-listing-modal/ir-listing-modal.tsx"],"names":[],"mappings":"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","sourcesContent":["import booking_listing from '@/stores/booking_listing.store';\r\nimport { Component, EventEmitter, Listen, Method, Prop, State, h, Event } from '@stencil/core';\r\nimport { Booking } from '@/models/booking.dto';\r\nimport locales from '@/stores/locales.store';\r\nimport { BookingListingService } from '@/services/booking_listing.service';\r\nimport { PaymentService } from '@/services/payment.service';\r\nimport moment from 'moment';\r\n\r\n@Component({\r\n  tag: 'ir-listing-modal',\r\n  styleUrl: 'ir-listing-modal.css',\r\n  scoped: true,\r\n})\r\nexport class IrListingModal {\r\n  @Prop() modalTitle: string = 'Modal Title';\r\n  @Prop() editBooking: { booking: Booking; cause: 'edit' | 'payment' | 'delete' };\r\n\r\n  @State() isOpen: boolean = false;\r\n  @State() deletionStage = 1;\r\n  @State() selectedDesignation: string;\r\n\r\n  private bookingListingsService = new BookingListingService();\r\n  private paymentService = new PaymentService();\r\n\r\n  componentWillLoad() {\r\n    this.bookingListingsService.setToken(booking_listing.token);\r\n    this.paymentService.setToken(booking_listing.token);\r\n    this.selectedDesignation = booking_listing.settlement_methods[0].name;\r\n  }\r\n\r\n  @Event() modalClosed: EventEmitter<null>;\r\n  @Event() resetData: EventEmitter<null>;\r\n  @Method()\r\n  async closeModal() {\r\n    this.isOpen = false;\r\n    this.deletionStage = 1;\r\n    this.selectedDesignation = booking_listing.settlement_methods[0].name;\r\n    this.modalClosed.emit(null);\r\n  }\r\n  @Method()\r\n  async openModal() {\r\n    this.isOpen = true;\r\n  }\r\n\r\n  @Listen('clickHanlder')\r\n  async btnClickHandler(event: CustomEvent) {\r\n    let target = event.target as HTMLInputElement;\r\n    let name = target.name;\r\n    try {\r\n      if (name === 'confirm') {\r\n        if (this.editBooking.cause === 'payment') {\r\n          await this.paymentService.AddPayment(\r\n            {\r\n              amount: this.editBooking.booking.financial.due_amount,\r\n              currency: this.editBooking.booking.currency,\r\n              date: moment().format('YYYY-MM-DD'),\r\n              designation: this.selectedDesignation,\r\n              id: -1,\r\n              reference: '',\r\n            },\r\n            this.editBooking.booking.booking_nbr,\r\n          );\r\n          this.resetData.emit(null);\r\n          this.closeModal();\r\n        } else {\r\n          if (this.deletionStage === 1) {\r\n            this.deletionStage = 2;\r\n          }\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error(error);\r\n    }\r\n    if (name === 'cancel') {\r\n      if (this.deletionStage === 2) {\r\n        return;\r\n      }\r\n      this.closeModal();\r\n    }\r\n  }\r\n\r\n  renderTitle() {\r\n    if (this.editBooking.cause === 'payment') {\r\n      return locales.entries?.Lcz_MarkBookingAsPaid.replace('%1', this.editBooking.booking.booking_nbr);\r\n    } else {\r\n      if (this.deletionStage === 1) {\r\n        return locales.entries.Lcz_SureYouWantToDeleteBookingNbr + this.editBooking?.booking.booking_nbr;\r\n      }\r\n      return locales.entries.Lcz_WantToRecoverAllotment;\r\n    }\r\n  }\r\n  renderConfirmationTitle() {\r\n    if (this.editBooking.cause === 'payment') {\r\n      return locales.entries.Lcz_Confirm;\r\n    } else {\r\n      if (this.deletionStage === 1) {\r\n        return locales.entries.Lcz_OK;\r\n      }\r\n      return locales.entries.Lcz_RecoverAndDelete;\r\n    }\r\n  }\r\n  renderCancelationTitle() {\r\n    if (this.deletionStage === 2) {\r\n      return locales.entries.Lcz_JustDelete;\r\n    }\r\n    return locales.entries.Lcz_Cancel;\r\n  }\r\n  render() {\r\n    if (!this.editBooking) {\r\n      return null;\r\n    }\r\n    return [\r\n      <div\r\n        class={`backdropModal ${this.isOpen ? 'active' : ''}`}\r\n        onClick={() => {\r\n          if (this.editBooking.cause === 'delete') {\r\n            return;\r\n          }\r\n          this.closeModal();\r\n        }}\r\n      ></div>,\r\n      <div data-state={this.isOpen ? 'opened' : 'closed'} class={`ir-modal`} tabindex=\"-1\">\r\n        <div class={`ir-alert-content p-2`}>\r\n          <div class={`ir-alert-header align-items-center border-0 py-0 m-0 `}>\r\n            <p class=\"font-weight-bold p-0 my-0 mb-1\">{this.renderTitle()}</p>\r\n            <ir-icon\r\n              class=\"exit-icon\"\r\n              style={{ cursor: 'pointer' }}\r\n              onClick={() => {\r\n                this.closeModal();\r\n              }}\r\n            >\r\n              <svg slot=\"icon\" xmlns=\"http://www.w3.org/2000/svg\" height=\"14\" width=\"10.5\" viewBox=\"0 0 384 512\">\r\n                <path\r\n                  fill=\"currentColor\"\r\n                  d=\"M342.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 210.7 86.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L146.7 256 41.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 301.3 297.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L237.3 256 342.6 150.6z\"\r\n                />\r\n              </svg>\r\n            </ir-icon>\r\n          </div>\r\n          <div class=\"modal-body text-left p-0 mb-2\">\r\n            {this.editBooking.cause === 'payment' ? (\r\n              <ir-select\r\n                selectedValue={this.selectedDesignation}\r\n                onSelectChange={e => (this.selectedDesignation = e.detail)}\r\n                showFirstOption={false}\r\n                LabelAvailable={false}\r\n                data={booking_listing.settlement_methods.map(m => ({\r\n                  value: m.name,\r\n                  text: m.name,\r\n                }))}\r\n              ></ir-select>\r\n            ) : null}\r\n          </div>\r\n\r\n          <div class={`ir-alert-footer border-0 d-flex justify-content-end`}>\r\n            <ir-button icon={''} btn_color={'secondary'} btn_block text={this.renderCancelationTitle()} name={'cancel'}></ir-button>\r\n            <ir-button icon={''} btn_color={'primary'} btn_block text={this.renderConfirmationTitle()} name={'confirm'}></ir-button>\r\n          </div>\r\n        </div>\r\n      </div>,\r\n    ];\r\n  }\r\n}\r\n"]}