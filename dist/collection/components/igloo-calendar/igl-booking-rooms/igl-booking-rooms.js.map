{"version":3,"file":"igl-booking-rooms.js","sourceRoot":"","sources":["../../../../src/components/igloo-calendar/igl-booking-rooms/igl-booking-rooms.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, Host, h, Prop, Event, EventEmitter, State } from '@stencil/core';\r\n\r\n@Component({\r\n  tag: 'igl-booking-rooms',\r\n  styleUrl: 'igl-booking-rooms.css',\r\n  scoped: true,\r\n})\r\nexport class IglBookingRooms {\r\n  @Prop({ reflect: true, mutable: true }) roomTypeData: { [key: string]: any };\r\n  @Prop() defaultData: { [key: string]: any };\r\n  @Prop() bookingType: string = 'PLUS_BOOKING';\r\n  @Prop({ reflect: true }) dateDifference: number;\r\n  @Prop() ratePricingMode = [];\r\n  @Prop() currency;\r\n  @Event() dataUpdateEvent: EventEmitter<{ [key: string]: any }>;\r\n  @State() selectedRooms: number[] = [];\r\n  @State() roomsDistributions: number[] = [];\r\n  private validBookingTypes = ['PLUS_BOOKING', 'ADD_ROOM', 'EDIT_BOOKING'];\r\n  private totalRooms: number;\r\n\r\n  componentWillLoad() {\r\n    this.totalRooms = this.roomTypeData.physicalrooms.length;\r\n    if (!this.selectedRooms.length) {\r\n      this.selectedRooms = new Array(this.totalRooms).fill(0);\r\n    }\r\n    if (!this.roomsDistributions.length) {\r\n      this.roomsDistributions = new Array(this.totalRooms).fill(this.totalRooms);\r\n    }\r\n  }\r\n\r\n  onRoomDataUpdate(event: CustomEvent<{ [key: string]: any }>, index: number) {\r\n    event.stopImmediatePropagation();\r\n    const opt: { [key: string]: any } = event.detail;\r\n    let data = { ...opt.data };\r\n    if (opt.changedKey === 'totalRooms') {\r\n      let newValue = data.totalRooms;\r\n      if (this.selectedRooms[index] !== newValue) {\r\n        this.selectedRooms[index] = newValue;\r\n        this.updateRatePlanTotalRooms(index);\r\n      }\r\n    }\r\n    data.roomCategoryId = this.roomTypeData.id;\r\n    data.roomCategoryName = this.roomTypeData.name;\r\n    data.inventory = this.roomTypeData.inventory;\r\n    this.dataUpdateEvent.emit({\r\n      key: opt.key,\r\n      data: data,\r\n      changedKey: opt.changedKey,\r\n    });\r\n  }\r\n\r\n  updateRatePlanTotalRooms(ratePlanIndex: number) {\r\n    const calculateTotalSelectedRoomsExcludingIndex = excludedIndex => {\r\n      return this.selectedRooms.reduce((acc, rooms, idx) => (idx !== excludedIndex ? acc + rooms : acc), 0);\r\n    };\r\n    const newRoomsDistributions = this.selectedRooms.map((_, index) => {\r\n      if (index === ratePlanIndex) {\r\n        return this.roomsDistributions[index];\r\n      }\r\n      const totalSelectedRoomsExcludingCurrent = calculateTotalSelectedRoomsExcludingIndex(index);\r\n      const availableRooms = this.totalRooms - totalSelectedRoomsExcludingCurrent;\r\n\r\n      return availableRooms > 0 ? availableRooms : 0;\r\n    });\r\n\r\n    if (JSON.stringify(this.roomsDistributions) !== JSON.stringify(newRoomsDistributions)) {\r\n      this.roomsDistributions = newRoomsDistributions;\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const isValidBookingType = this.validBookingTypes.includes(this.bookingType);\r\n    return (\r\n      <Host>\r\n        {isValidBookingType && <div class=\"font-weight-bold font-medium-1\">{this.roomTypeData.name}</div>}\r\n        {this.roomTypeData.rateplans.map((ratePlan, index) => {\r\n          if (ratePlan.variations !== null) {\r\n            return (\r\n              <igl-booking-room-rate-plan\r\n                key={`rate-plan-${ratePlan.id}`}\r\n                ratePricingMode={this.ratePricingMode}\r\n                class={isValidBookingType ? 'ml-1' : ''}\r\n                currency={this.currency}\r\n                dateDifference={this.dateDifference}\r\n                ratePlanData={ratePlan}\r\n                totalAvailableRooms={this.roomsDistributions[index]}\r\n                bookingType={this.bookingType}\r\n                defaultData={(this.defaultData && this.defaultData['p_' + ratePlan.id]) || null}\r\n                onDataUpdateEvent={evt => this.onRoomDataUpdate(evt, index)}\r\n              ></igl-booking-room-rate-plan>\r\n            );\r\n          } else {\r\n            return null;\r\n          }\r\n        })}\r\n      </Host>\r\n    );\r\n  }\r\n}\r\n"]}