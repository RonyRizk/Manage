{"version":3,"file":"ir-room-nights.js","sourceRoot":"","sources":["../../../src/components/ir-room-nights/ir-room-nights.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, Host, Prop, State, h, Event, EventEmitter, Fragment } from '@stencil/core';\r\nimport axios from 'axios';\r\nimport { BookingService } from '../../services/booking.service';\r\nimport { convertDatePrice, formatDate, getCurrencySymbol, getDaysArray } from '../../utils/utils';\r\nimport { store } from '../../redux/store';\r\nimport { Booking, Day, IUnit, Room } from '../../models/booking.dto';\r\nimport { IRoomNightsDataEventPayload } from '../../models/property-types';\r\nimport { v4 } from 'uuid';\r\nimport moment from 'moment';\r\nimport { Unsubscribe } from '@reduxjs/toolkit';\r\nimport { Languages } from '@/components';\r\n\r\n@Component({\r\n  tag: 'ir-room-nights',\r\n  styleUrl: 'ir-room-nights.css',\r\n  scoped: true,\r\n})\r\nexport class IrRoomNights {\r\n  @Prop() bookingNumber: string;\r\n  @Prop() baseUrl: string;\r\n  @Prop() propertyId: number;\r\n  @Prop() language: string;\r\n  @Prop() identifier: string;\r\n  @Prop() toDate: string;\r\n  @Prop() fromDate: string;\r\n  @Prop() pool: string;\r\n  @Prop() ticket: string;\r\n\r\n  @State() bookingEvent: Booking;\r\n  @State() selectedRoom: Room;\r\n  @State() defaultTexts: Languages;\r\n  @State() rates: Day[] = [];\r\n  @State() isLoading = false;\r\n  @State() initialLoading = false;\r\n  @State() inventory: number | null = null;\r\n  @State() isEndDateBeforeFromDate: boolean = false;\r\n  @State() defaultTotalNights = 0;\r\n\r\n  @Event() closeRoomNightsDialog: EventEmitter<IRoomNightsDataEventPayload>;\r\n\r\n  private bookingService = new BookingService();\r\n  private unsubscribe: Unsubscribe;\r\n\r\n  componentWillLoad() {\r\n    if (this.baseUrl) {\r\n      axios.defaults.baseURL = this.baseUrl;\r\n    }\r\n    this.init();\r\n  }\r\n\r\n  updateStore() {\r\n    this.defaultTexts = store.getState().languages;\r\n  }\r\n  isButtonDisabled() {\r\n    return this.isLoading || this.rates.some(rate => rate.amount === 0 || rate.amount === -1) || this.inventory === 0 || this.inventory === null;\r\n  }\r\n  async init() {\r\n    try {\r\n      this.updateStore();\r\n      this.bookingEvent = await this.bookingService.getExposedBooking(this.bookingNumber, this.language);\r\n      if (this.bookingEvent) {\r\n        const filteredRooms = this.bookingEvent.rooms.filter(room => room.identifier === this.identifier);\r\n        this.selectedRoom = filteredRooms[0];\r\n\r\n        const lastDay = this.selectedRoom?.days[this.selectedRoom.days.length - 1];\r\n        let first_rate = this.selectedRoom.days[0].amount;\r\n        if (moment(this.toDate).add(-1, 'days').isSame(moment(lastDay.date))) {\r\n          this.fetchBookingAvailability(this.fromDate, this.bookingEvent.from_date);\r\n          const newDatesArr = getDaysArray(this.selectedRoom.days[0].date, this.fromDate);\r\n          this.isEndDateBeforeFromDate = true;\r\n          this.rates;\r\n          this.rates = [\r\n            ...newDatesArr.map(day => ({\r\n              amount: first_rate,\r\n              date: day,\r\n            })),\r\n            ...this.selectedRoom.days,\r\n          ];\r\n        } else {\r\n          this.fetchBookingAvailability(this.bookingEvent.to_date, this.toDate);\r\n          const newDatesArr = getDaysArray(lastDay.date, this.toDate);\r\n          this.rates = [\r\n            ...this.selectedRoom.days,\r\n            ...newDatesArr.map(day => ({\r\n              amount: first_rate,\r\n              date: day,\r\n            })),\r\n          ];\r\n        }\r\n        this.defaultTotalNights = this.rates.length - this.selectedRoom.days.length;\r\n      }\r\n      this.unsubscribe = store.subscribe(() => this.updateStore());\r\n    } catch (error) {\r\n      console.log(error);\r\n    }\r\n  }\r\n  disconnectedCallback() {\r\n    this.unsubscribe();\r\n  }\r\n  handleInput(event: InputEvent, index: number) {\r\n    let inputElement = event.target as HTMLInputElement;\r\n    let inputValue = inputElement.value;\r\n\r\n    let days = [...this.rates];\r\n    if (!isNaN(Number(inputValue))) {\r\n      days[index].amount = +inputValue;\r\n    } else {\r\n      inputValue = inputValue.replace(/[^0-9]/g, '');\r\n      inputElement.value = inputValue;\r\n      if (inputValue === '') {\r\n        days[index].amount = -1;\r\n      } else {\r\n        days[index].amount = +inputValue;\r\n      }\r\n    }\r\n    this.rates = days;\r\n  }\r\n  async fetchBookingAvailability(from_date: string, to_date: string) {\r\n    try {\r\n      this.initialLoading = true;\r\n      const bookingAvailability = await this.bookingService.getBookingAvailability(\r\n        from_date,\r\n        to_date,\r\n        this.propertyId,\r\n        {\r\n          adult: this.selectedRoom.rateplan.selected_variation.adult_nbr,\r\n          child: this.selectedRoom.rateplan.selected_variation.child_nbr,\r\n        },\r\n        this.language,\r\n        [this.selectedRoom.roomtype.id],\r\n        this.bookingEvent.currency,\r\n      );\r\n      this.inventory = bookingAvailability.roomtypes[0].inventory;\r\n    } catch (error) {\r\n      console.log(error);\r\n    } finally {\r\n      this.initialLoading = false;\r\n    }\r\n  }\r\n  renderInputField(index: number, currency_symbol: string, day: Day) {\r\n    return (\r\n      <fieldset class=\"col-2 ml-1 position-relative has-icon-left m-0 p-0 rate-input-container\">\r\n        <input\r\n          disabled={this.inventory === 0 || this.inventory === null}\r\n          type=\"text\"\r\n          class=\"form-control input-sm rate-input py-0 m-0 rateInputBorder\"\r\n          id={v4()}\r\n          value={day.amount > 0 ? day.amount : ''}\r\n          placeholder={this.defaultTexts.entries.Lcz_Rate || 'Rate'}\r\n          onInput={event => this.handleInput(event, index)}\r\n        />\r\n        <span class=\"currency\">{currency_symbol}</span>\r\n      </fieldset>\r\n    );\r\n  }\r\n  renderReadOnlyField(currency_symbol: string, day: Day) {\r\n    return <p class=\"col-9 ml-1 m-0 p-0\">{`${currency_symbol}${day.amount}`}</p>;\r\n  }\r\n  renderRateFields(index: number, currency_symbol: string, day: Day) {\r\n    if (this.isEndDateBeforeFromDate) {\r\n      if (index < this.defaultTotalNights) {\r\n        return this.renderInputField(index, currency_symbol, day);\r\n      } else {\r\n        return this.renderReadOnlyField(currency_symbol, day);\r\n      }\r\n    } else {\r\n      return index < this.selectedRoom.days.length ? this.renderReadOnlyField(currency_symbol, day) : this.renderInputField(index, currency_symbol, day);\r\n    }\r\n  }\r\n  renderDates() {\r\n    const currency_symbol = getCurrencySymbol(this.bookingEvent.currency.code);\r\n    return (\r\n      <div class={'mt-2 m-0'}>\r\n        {this.rates?.map((day, index) => (\r\n          <div class={'row m-0 mt-1 align-items-center'}>\r\n            <p class={'col-2 m-0 p-0'}>{convertDatePrice(day.date)}</p>\r\n            {this.renderRateFields(index, currency_symbol, day)}\r\n          </div>\r\n        ))}\r\n      </div>\r\n    );\r\n  }\r\n  async handleRoomConfirmation() {\r\n    try {\r\n      this.isLoading = true;\r\n      let oldRooms = [...this.bookingEvent.rooms];\r\n      let selectedRoomIndex = oldRooms.findIndex(room => room.identifier === this.identifier);\r\n      if (selectedRoomIndex === -1) {\r\n        throw new Error('Invalid Pool');\r\n      }\r\n      oldRooms[selectedRoomIndex] = { ...oldRooms[selectedRoomIndex], days: this.rates, to_date: this.toDate, from_date: this.fromDate };\r\n      const body = {\r\n        assign_units: true,\r\n        check_in: true,\r\n        is_pms: true,\r\n        is_direct: true,\r\n        booking: {\r\n          booking_nbr: this.bookingNumber,\r\n          from_date: this.fromDate,\r\n          to_date: this.toDate,\r\n          remark: this.bookingEvent.remark,\r\n          property: this.bookingEvent.property,\r\n          source: this.bookingEvent.source,\r\n          currency: this.bookingEvent.currency,\r\n          arrival: this.bookingEvent.arrival,\r\n          guest: this.bookingEvent.guest,\r\n          rooms: oldRooms,\r\n        },\r\n      };\r\n      const { data } = await axios.post(`/DoReservation?Ticket=${this.ticket}`, body);\r\n      if (data.ExceptionMsg !== '') {\r\n        throw new Error(data.ExceptionMsg);\r\n      }\r\n      this.closeRoomNightsDialog.emit({ type: 'confirm', pool: this.pool });\r\n    } catch (error) {\r\n    } finally {\r\n      this.isLoading = false;\r\n    }\r\n  }\r\n  render() {\r\n    if (!this.bookingEvent) {\r\n      return <p>{this.defaultTexts.entries.Lcz_Loading}</p>;\r\n    }\r\n    return (\r\n      <Host>\r\n        <div class=\"card position-sticky mb-0 shadow-none p-0 \">\r\n          <div class=\"d-flex mt-2 align-items-center justify-content-between \">\r\n            <h3 class=\"card-title text-left pb-1 font-medium-2 px-2\">\r\n              {this.defaultTexts.entries.Lcz_AddingRoomNightsTo} {this.selectedRoom?.roomtype?.name} {(this.selectedRoom?.unit as IUnit).name}\r\n            </h3>\r\n            <button type=\"button\" class=\"close close-icon\" onClick={() => this.closeRoomNightsDialog.emit({ type: 'cancel', pool: this.pool })}>\r\n              <ir-icon icon=\"ft-x\" class={'m-0'}></ir-icon>\r\n            </button>\r\n          </div>\r\n        </div>\r\n        <section class={'text-left px-2'}>\r\n          <p>\r\n            {`${this.defaultTexts.entries.Lcz_Booking}#`} {this.bookingNumber}\r\n          </p>\r\n          <p class={'font-weight-bold font-medium-1'}>{`${formatDate(this.bookingEvent.from_date, 'YYYY-MM-DD')} - ${formatDate(this.bookingEvent.to_date, 'YYYY-MM-DD')}`}</p>\r\n          {this.initialLoading ? (\r\n            <p class={'mt-2 text-secondary'}>{this.defaultTexts.entries['Lcz_CheckingRoomAvailability ']}</p>\r\n          ) : (\r\n            <Fragment>\r\n              <p class={'font-medium-1 mb-0'}>\r\n                {`${this.selectedRoom.rateplan.name}`}{' '}\r\n                {this.selectedRoom.rateplan.is_non_refundable && <span class={'irfontgreen'}>{this.defaultTexts.entries.Lcz_NonRefundable}</span>}\r\n              </p>\r\n              {this.selectedRoom.rateplan.custom_text && <p class={'text-secondary mt-0'}>{this.selectedRoom.rateplan.custom_text}</p>}\r\n              {this.renderDates()}\r\n            </Fragment>\r\n          )}\r\n        </section>\r\n        <section class={'d-flex align-items-center mt-2 px-2'}>\r\n          <button\r\n            disabled={this.isLoading}\r\n            type=\"button\"\r\n            class={'btn btn-secondary full-width'}\r\n            onClick={() => this.closeRoomNightsDialog.emit({ type: 'cancel', pool: this.pool })}\r\n          >\r\n            {this.defaultTexts?.entries.Lcz_Cancel}\r\n          </button>\r\n          <button disabled={this.isButtonDisabled()} type=\"button\" class={'btn btn-primary ml-2 full-width'} onClick={this.handleRoomConfirmation.bind(this)}>\r\n            {this.isLoading && <i class=\"la la-circle-o-notch spinner mx-1\"></i>}\r\n            {this.defaultTexts?.entries.Lcz_Confirmation}\r\n          </button>\r\n        </section>\r\n      </Host>\r\n    );\r\n  }\r\n}\r\n"]}