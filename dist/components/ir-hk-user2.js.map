{"file":"ir-hk-user2.js","mappings":"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","names":[],"sources":["src/utils/validation.ts","src/components/ir-housekeeping/ir-hk-user/ir-hk-user.css?tag=ir-hk-user&encapsulation=scoped","src/components/ir-housekeeping/ir-hk-user/ir-hk-user.tsx"],"sourcesContent":["export type ValidationRule = {\r\n  required?: boolean;\r\n  minLength?: number;\r\n  maxLength?: number;\r\n  minValue?: number;\r\n  maxValue?: number;\r\n  pattern?: RegExp;\r\n  custom?: (value: any) => boolean;\r\n};\r\n\r\ntype ValidationResult = {\r\n  isValid: boolean;\r\n  errors: { [key: string]: string[] };\r\n};\r\n\r\nexport function validateForm<T>(data: T, rules: { [P in keyof T]?: ValidationRule }): ValidationResult {\r\n  let isValid = true;\r\n  const errors: { [key: string]: string[] } = {};\r\n\r\n  for (const fieldName in rules) {\r\n    const rulesForField = rules[fieldName];\r\n    const value = data[fieldName];\r\n    if (!rulesForField) continue;\r\n\r\n    errors[fieldName] = [];\r\n\r\n    // Required\r\n    if (rulesForField.required && (value === null || value === undefined || value === '')) {\r\n      isValid = false;\r\n      errors[fieldName].push('This field is required.');\r\n    }\r\n\r\n    // String Length\r\n    if (typeof value === 'string') {\r\n      if (rulesForField.minLength !== undefined && value.length < rulesForField.minLength) {\r\n        isValid = false;\r\n        errors[fieldName].push(`Minimum length is ${rulesForField.minLength}.`);\r\n      }\r\n      if (rulesForField.maxLength !== undefined && value.length > rulesForField.maxLength) {\r\n        isValid = false;\r\n        errors[fieldName].push(`Maximum length is ${rulesForField.maxLength}.`);\r\n      }\r\n    }\r\n\r\n    // Numeric Range\r\n    if (typeof value === 'number') {\r\n      if (rulesForField.minValue !== undefined && value < rulesForField.minValue) {\r\n        isValid = false;\r\n        errors[fieldName].push(`Minimum value is ${rulesForField.minValue}.`);\r\n      }\r\n      if (rulesForField.maxValue !== undefined && value > rulesForField.maxValue) {\r\n        isValid = false;\r\n        errors[fieldName].push(`Maximum value is ${rulesForField.maxValue}.`);\r\n      }\r\n    }\r\n\r\n    // Regular Expression\r\n    if (rulesForField.pattern && !rulesForField.pattern.test(String(value))) {\r\n      isValid = false;\r\n      errors[fieldName].push('Invalid format.');\r\n    }\r\n\r\n    // Custom Validation\r\n    if (rulesForField.custom && !rulesForField.custom(value)) {\r\n      isValid = false;\r\n      errors[fieldName].push('Custom validation failed.');\r\n    }\r\n  }\r\n\r\n  return { isValid, errors };\r\n}\r\n",":host {\r\n  display: block;\r\n}\r\n","import { THKUser } from '@/models/housekeeping';\r\nimport { HouseKeepingService } from '@/services/housekeeping.service';\r\nimport calendar_data from '@/stores/calendar-data';\r\nimport { getDefaultProperties } from '@/stores/housekeeping.store';\r\nimport locales from '@/stores/locales.store';\r\nimport { ValidationRule, validateForm } from '@/utils/validation';\r\nimport { Component, Host, Prop, State, h, Event, EventEmitter } from '@stencil/core';\r\n\r\n@Component({\r\n  tag: 'ir-hk-user',\r\n  styleUrl: 'ir-hk-user.css',\r\n  scoped: true,\r\n})\r\nexport class IrHkUser {\r\n  @Prop() user: THKUser | null = null;\r\n  @Prop() isEdit: boolean = false;\r\n\r\n  @State() isLoading: boolean = false;\r\n  @State() userInfo: THKUser = {\r\n    id: -1,\r\n    mobile: '',\r\n    name: '',\r\n    note: '',\r\n    password: '',\r\n    property_id: null,\r\n    username: null,\r\n    phone_prefix: null,\r\n  };\r\n\r\n  @State() errors: { [P in keyof THKUser]?: any } | null = null;\r\n\r\n  @Event() resetData: EventEmitter<null>;\r\n  @Event() closeSideBar: EventEmitter<null>;\r\n\r\n  private housekeepingService = new HouseKeepingService();\r\n  private default_properties = {\r\n    token: '',\r\n    language: '',\r\n  };\r\n\r\n  async componentWillLoad() {\r\n    const { token, language, property_id } = getDefaultProperties();\r\n    this.default_properties = { token, language };\r\n    this.housekeepingService.setToken(token);\r\n    if (!this.user) {\r\n      this.userInfo['property_id'] = property_id;\r\n    }\r\n    if (this.user) {\r\n      this.userInfo = { ...this.user };\r\n    }\r\n    console.log(this.userInfo);\r\n  }\r\n\r\n  updateUserField(key: keyof THKUser, value: any) {\r\n    this.userInfo = { ...this.userInfo, [key]: value };\r\n  }\r\n\r\n  async addUser() {\r\n    try {\r\n      this.isLoading = true;\r\n      const validationRules: { [P in keyof THKUser]?: ValidationRule } = {\r\n        name: { required: true },\r\n        mobile: { required: true },\r\n        password: { required: true, minLength: 5 },\r\n      };\r\n      const validationResult = validateForm(this.userInfo, validationRules);\r\n      if (!validationResult.isValid) {\r\n        this.errors = validationResult.errors;\r\n        return;\r\n      }\r\n      if (this.errors) {\r\n        this.errors = null;\r\n      }\r\n      await this.housekeepingService.editExposedHKM(this.userInfo);\r\n      this.resetData.emit(null);\r\n      this.closeSideBar.emit(null);\r\n    } catch (error) {\r\n      console.error(error);\r\n    } finally {\r\n      this.isLoading = false;\r\n    }\r\n  }\r\n  async handleBlur(e: CustomEvent) {\r\n    e.stopImmediatePropagation();\r\n    e.stopPropagation();\r\n    if (this.user || !this.userInfo.name) {\r\n      return;\r\n    }\r\n    const usermame = await this.housekeepingService.generateUserName(this.userInfo.name);\r\n    this.updateUserField('username', usermame);\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <Host>\r\n        <ir-title class=\"px-1\" displayContext=\"sidebar\" label={this.isEdit ? locales.entries.Lcz_EditHousekeeperProfile : locales.entries.Lcz_CreateHousekeeperProfile}></ir-title>\r\n        <section class=\"px-1\">\r\n          <ir-input-text\r\n            error={this.errors?.name?.length > 0}\r\n            label={locales.entries.Lcz_Name}\r\n            placeholder={locales.entries.Lcz_Name}\r\n            onTextChange={e => this.updateUserField('name', e.detail)}\r\n            value={this.userInfo.name}\r\n            onInputBlur={this.handleBlur.bind(this)}\r\n          ></ir-input-text>\r\n          <ir-phone-input\r\n            placeholder={locales.entries.Lcz_Mobile}\r\n            error={this.errors?.mobile?.length > 0}\r\n            language={this.default_properties.language}\r\n            token={this.default_properties.token}\r\n            default_country={calendar_data.country.id}\r\n            phone_prefix={this.user?.phone_prefix}\r\n            label={locales.entries.Lcz_Mobile}\r\n            value={this.userInfo.mobile}\r\n            onTextChange={e => {\r\n              this.updateUserField('phone_prefix', e.detail.phone_prefix);\r\n              this.updateUserField('mobile', e.detail.mobile);\r\n            }}\r\n          ></ir-phone-input>\r\n\r\n          <ir-input-text\r\n            disabled={this.user !== null}\r\n            label={locales.entries.Lcz_Username}\r\n            placeholder={locales.entries.Lcz_Username}\r\n            value={this.userInfo.username}\r\n            onTextChange={e => this.updateUserField('username', e.detail)}\r\n          ></ir-input-text>\r\n\r\n          <ir-input-text\r\n            label={locales.entries.Lcz_Password}\r\n            placeholder={locales.entries.Lcz_MinimumCharacter}\r\n            value={this.userInfo.password}\r\n            type=\"password\"\r\n            error={this.errors?.password?.length > 0}\r\n            onTextChange={e => this.updateUserField('password', e.detail)}\r\n          ></ir-input-text>\r\n          <ir-input-text\r\n            label={locales.entries.Lcz_Note}\r\n            placeholder={locales.entries.Lcz_Note}\r\n            value={this.userInfo.note}\r\n            onTextChange={e => this.updateUserField('note', e.detail)}\r\n          ></ir-input-text>\r\n          <div class=\"d-flex flex-column flex-md-row align-items-md-center mt-2 w-100\">\r\n            <ir-button\r\n              onClickHanlder={() => this.closeSideBar.emit(null)}\r\n              class=\"flex-fill\"\r\n              btn_styles=\"w-100  justify-content-center align-items-center\"\r\n              btn_color=\"secondary\"\r\n              text={locales.entries.Lcz_Cancel}\r\n            ></ir-button>\r\n            <ir-button\r\n              isLoading={this.isLoading}\r\n              onClickHanlder={this.addUser.bind(this)}\r\n              class=\"flex-fill ml-md-1\"\r\n              btn_styles=\"w-100  justify-content-center align-items-center mt-1 mt-md-0\"\r\n              text={locales.entries.Lcz_Save}\r\n            ></ir-button>\r\n          </div>\r\n        </section>\r\n      </Host>\r\n    );\r\n  }\r\n}\r\n"],"version":3}