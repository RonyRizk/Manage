import{r as t,c as s,h as i,g as e}from"./p-a4ee474f.js";import{h as a}from"./p-fe6c3d31.js";import{_ as h,a as o}from"./p-30bf9f71.js";import{B as r,a as n}from"./p-419f5f67.js";const l=".confirmed{color:#fff;display:flex;align-items:center}ir-select#update-status{transform:translateY(0.5rem)}.pointer{cursor:pointer}:root{--sidebar-width:50rem}.sm-padding-right{padding-right:0.2rem}.sm-padding-left{padding-left:0.2rem}.sm-padding-top{padding-top:0.2rem}.sm-padding-bottom{padding-bottom:0.2rem}.info-notes{list-style:none;padding-left:0}.light-blue-bg{background-color:#acecff;padding:0rem 0.1rem}.iframeHeight{height:17.5rem}";const d=class{constructor(i){t(this,i);this.sendDataToServer=s(this,"sendDataToServer",7);this.handlePrintClick=s(this,"handlePrintClick",7);this.handleReceiptClick=s(this,"handleReceiptClick",7);this.handleDeleteClick=s(this,"handleDeleteClick",7);this.handleMenuClick=s(this,"handleMenuClick",7);this.handleRoomAdd=s(this,"handleRoomAdd",7);this.handleRoomEdit=s(this,"handleRoomEdit",7);this.handleRoomDelete=s(this,"handleRoomDelete",7);this.handleAddPayment=s(this,"handleAddPayment",7);this.bookingService=new r;this.bookingDetails=null;this.setupDataCountries=null;this.setupDataCountriesCode=null;this.languageAbreviation="";this.language="";this.ticket="";this.bookingNumber="";this.baseurl="";this.dropdownStatuses=[];this.paymentDetailsUrl="";this.paymentExceptionMessage="";this.statusCodes=[];this.hasPrint=false;this.hasReceipt=false;this.hasDelete=false;this.hasMenu=false;this.hasRoomEdit=false;this.hasRoomDelete=false;this.hasRoomAdd=false;this.hasCheckIn=false;this.hasCheckOut=false;this.statusData=[];this.tempStatus=null;this.bookingData=undefined;this.guestData=null;this.rerenderFlag=false}componentDidLoad(){if(this.baseurl){n.defaults.baseURL=this.baseurl}if(this.ticket!==""){this.initializeApp()}}async ticketChanged(){sessionStorage.setItem("token",JSON.stringify(this.ticket));this.initializeApp()}async initializeApp(){const t=await this.bookingService.getExoposedBooking(this.bookingNumber,this.language);this.guestData=t.guest;this.bookingData=t;this.rerenderFlag=!this.rerenderFlag;console.log(this.bookingData)}handleIconClick(t){const s=t.target;switch(s.id){case"print":this.handlePrintClick.emit();return;case"receipt":this.handleReceiptClick.emit();return;case"book-delete":this.handleDeleteClick.emit();return;case"menu":this.element.querySelector("ir-sidebar").open=true;this.handleMenuClick.emit();return;case"room-add":this.handleRoomAdd.emit();return;case"add-payment":this.handleAddPayment.emit();return}const i=s.id;if(i.includes("roomEdit")){const t=s.id.split("-")[1];this.handleRoomEdit.emit(t)}else if(s.id.includes("roomDelete")){const t=s.id.split("-")[1];this.handleRoomDelete.emit(t)}}handleSidebarToggle(){const t=document.querySelector("ir-sidebar#editGuestInfo");t.open=false}handleEditSidebar(){this.openEditSidebar()}handleFormSubmit(t){const s=t.detail;const i=this.bookingDetails;i.My_Guest.FIRST_NAME=s.firstName;i.My_Guest.LAST_NAME=s.lastName;i.My_Guest.COUNTRY_ID=s.country;i.My_Guest.CITY=s.city;i.My_Guest.ADDRESS=s.address;i.My_Guest.MOBILE=s.mobile;i.My_Guest.PHONE_PREFIX=s.prefix;i.My_Guest.IS_NEWS_LETTER=s.newsletter;i.My_Guest.My_User.CURRENCY=s.currency;i.My_Guest.My_User.DISCLOSED_EMAIL=s.altEmail;i.My_Guest.My_User.PASSWORD=s.password;i.My_Guest.My_User.EMAIL=s.email;this.bookingDetails=i;console.log("Form submitted with data: ",this.bookingDetails);this.rerenderFlag=!this.rerenderFlag;const e=document.querySelector("ir-sidebar#editGuestInfo");e.open=false;this.sendDataToServer.emit(this.bookingDetails)}handleSelectChange(t){const s=t.target;const i=s.id;switch(i){case"update-status":this.tempStatus=t.detail;break}}handleClick(t){const s=t.target;const i=s.id;switch(i){case"update-status-btn":this.updateStatus();break}}watchDropdownStatuses(t,s){console.log("The new value of dropdownStatuses is: ",t);console.log("The old value of dropdownStatuses is: ",s);try{const s=t.map((t=>({value:t.CODE_NAME,text:this._getBookingStatus(t.CODE_NAME,"_BOOK_STATUS")})));this.statusData=s;console.log("The new value of statusData is: ",this.statusData);this.rerenderFlag=!this.rerenderFlag}catch(t){console.log("Error in watchDropdownStatuses: ",t)}}openEditSidebar(){const t=document.querySelector("ir-sidebar#editGuestInfo");t.open=true}_calculateNights(t,s){const i=a(s).diff(a(t),"days");return i}_getBookingStatus(t,s){const i=this.statusCodes.find((i=>i.CODE_NAME===t&&i.TBL_NAME===s));const e=i[`CODE_VALUE_${this.languageAbreviation}`];return e}updateStatus(){const t=this.bookingDetails;t.BOOK_STATUS_CODE=this.tempStatus;this.bookingDetails=t;this.rerenderFlag=!this.rerenderFlag;this.sendDataToServer.emit(this.bookingDetails)}render(){if(!this.bookingData){return null}let t="";switch(this.bookingData.status.code){case"001":t="bg-ir-orange";break;case"002":t="bg-ir-green";break;case"003":t="bg-ir-red";break;case"004":t="bg-ir-red";break}return[i("ir-common",null),i("div",{class:"fluid-container pt-1 mr-2 ml-2"},i("div",{class:"row"},i("div",{class:"col-lg-7 col-md-12 d-flex justify-content-start align-items-end"},i("div",{class:"font-size-large sm-padding-right"},`Booking#${this.bookingNumber}`),i("div",null,"@ ",h(this.bookingData.booked_on.date)," ",o(this.bookingData.booked_on.hour.toString(),+" "+this.bookingData.booked_on.minute.toString()))),i("div",{class:"col-lg-5 col-md-12 d-flex justify-content-end align-items-center"},i("span",{class:`confirmed btn-sm mr-2 ${t}`},this.bookingData.status.description),i("ir-select",{id:"update-status",size:"sm","label-available":"false",data:this.statusData,textSize:"sm",class:"sm-padding-right"}),i("ir-button",{icon:"",id:"update-status-btn",size:"sm",text:"Update"}),this.hasReceipt&&i("ir-icon",{id:"receipt",icon:"ft-file-text h1 color-ir-dark-blue-hover ml-1 pointer"}),this.hasPrint&&i("ir-icon",{id:"print",icon:"ft-printer h1 color-ir-dark-blue-hover ml-1 pointer"}),this.hasDelete&&i("ir-icon",{id:"book-delete",icon:"ft-trash-2 h1 danger ml-1 pointer"}),this.hasMenu&&i("ir-icon",{id:"menu",icon:"ft-list h1 color-ir-dark-blue-hover ml-1 pointer"})))),i("div",{class:"fluid-container m-1"},i("div",{class:"row m-0"},i("div",{class:"col-lg-7 col-md-12 pl-0 pr-lg-1 p-0"},i("div",{class:"card"},i("div",{class:"p-1"},this.bookingData.property.name||"",i("ir-label",{label:"Source:",value:this.bookingData.origin.Label,imageSrc:this.bookingData.origin.Icon}),i("ir-label",{label:"Booked by:",value:`${this.bookingData.guest.first_name} ${this.bookingData.guest.last_name}`,iconShown:true}),i("ir-label",{label:"Phone:",value:this.bookingData.guest.mobile}),i("ir-label",{label:"Email:",value:this.bookingData.guest.email}),i("ir-label",{label:"Address:",value:this.bookingData.guest.address}),i("ir-label",{label:"Arrival Time:",value:this.bookingData.arrival.description}),i("ir-label",{label:"Notes:",value:this.bookingData.remark}))),i("div",{class:"font-size-large d-flex justify-content-between align-items-center ml-1 mb-1"},`${h(this.bookingData.from_date)} - ${h(this.bookingData.to_date)} (${this._calculateNights(this.bookingData.from_date,this.bookingData.to_date)} ${this._calculateNights(this.bookingData.from_date,this.bookingData.to_date)>1?"nights":"night"})`,this.hasRoomAdd&&i("ir-icon",{id:"room-add",icon:"ft-plus h3 color-ir-dark-blue-hover pointer"})),i("div",{class:"card"},this.bookingData.rooms.map(((t,s)=>{const e=t.rateplan.name;const a=t.roomtype.name;return[i("ir-room",{myRoomTypeFoodCat:a,mealCodeName:e,currency:this.bookingData.currency.code,hasRoomEdit:this.hasRoomEdit,hasRoomDelete:this.hasRoomDelete,hasCheckIn:this.hasCheckIn,hasCheckOut:this.hasCheckOut,item:t}),s!==this.bookingData.rooms.length-1&&i("hr",{class:"mr-2 ml-2 mt-1 mb-1"})]})))))),i("ir-sidebar",{side:"right",id:"editGuestInfo"},i("ir-guest-info",{data:this.guestData,setupDataCountries:this.setupDataCountries,setupDataCountriesCode:this.setupDataCountriesCode}))]}get element(){return e(this)}static get watchers(){return{ticket:["ticketChanged"],dropdownStatuses:["watchDropdownStatuses"]}}};d.style=l;export{d as ir_booking_details};
//# sourceMappingURL=p-512474cf.entry.js.map