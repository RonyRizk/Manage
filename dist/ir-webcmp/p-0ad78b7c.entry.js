import{r as e,c as t,h as i,F as s,H as l,g as r}from"./p-52db726c.js";import{a as o,b as a,l as n,h as c}from"./p-84483b2b.js";class d{constructor(){this.token=JSON.parse(sessionStorage.getItem("token"))}async savePickup(e,t){try{const i=e.arrival_time.split(":");await o.post(`/Do_Pickup?Ticket=${this.token}`,{booking_nbr:t,is_remove:false,currency:e.currency,date:e.arrival_date,details:e.flight_details,hour:i[0],minute:i[1],nbr_of_units:e.number_of_vehicles,selected_option:e.selected_option,total:e.due_upon_booking})}catch(e){console.log(e)}}validateForm(e){if(e.arrival_time.split(":").length!==2){return{error:true,cause:"arrival_time"}}if(e.flight_details===""){return{error:true,cause:"flight_details"}}if(e.vehicle_type_code===""){return{error:true,cause:"vehicle_type_code"}}if(e.number_of_vehicles===0){return{error:true,cause:"number_of_vehicles"}}return{error:false}}updateDue(e){const t=a.pickup_service.allowed_pricing_models.find((t=>t.code===e.code));if(!t){return}if(t.description==="Person"){return e.amount*e.numberOfPersons}else{return e.amount*e.number_of_vehicles}}getNumberOfVehicles(){}}const u=".sc-ir-pickup-h{display:block}.card-title.sc-ir-pickup{border-bottom:1px solid #e4e5ec;width:100%}";const h=class{constructor(i){e(this,i);this.closeModal=t(this,"closeModal",7);this.pickupService=new d;this.defaultPickupData=undefined;this.numberOfPersons=0;this.bookingNumber=undefined;this.isLoading=false;this.allowedOptionsByLocation=[];this.pickupData={location:"",flight_details:"",due_upon_booking:"",number_of_vehicles:1,vehicle_type_code:"",currency:undefined,arrival_time:"",arrival_date:"",selected_option:undefined};this.vehicleCapacity=1;this.cause=null}handleLocationChange(e){e.stopImmediatePropagation();e.stopPropagation();const t=e.detail;if(t!==""){this.allowedOptionsByLocation=a.pickup_service.allowed_options.filter((e=>e.location.id.toString()===t));let e=this.allowedOptionsByLocation[0];if(!e){return}this.pickupData=Object.assign(Object.assign({},this.pickupData),{location:t,selected_option:e,due_upon_booking:this.pickupService.updateDue({amount:e.amount,code:e.pricing_model.code,numberOfPersons:this.numberOfPersons,number_of_vehicles:this.pickupData.number_of_vehicles}).toFixed(2),vehicle_type_code:e.vehicle.code,currency:e.currency});const i=this.el.querySelector("#pickup-time");if(!i){setTimeout((()=>{this.initializeInputMask()}),100)}}}initializeInputMask(){const e=this.el.querySelector("#pickup-time");if(e){Inputmask("Hh:mm",{placeholder:"HH:mm",definitions:{H:{validator:"[0-1]"},h:{validator:"[0-9]"},M:{validator:"[0-5]"},m:{validator:"[0-9]"}},insertMode:true,showMaskOnHover:false,inputmode:"numeric",alias:"datetime",oncomplete:()=>{this.updatePickupData("arrival_time",e.value)},oncleared:function(){this.updatePickupData("arrival_time","")},onincomplete:function(){this.updatePickupData("arrival_time",e.value)}}).mask(e)}}handleVehicleTypeChange(e){if(e.detail===""){this.pickupData=Object.assign(Object.assign({},this.pickupData),{due_upon_booking:"",vehicle_type_code:""});return}let t=a.pickup_service.allowed_options.find((t=>t.location.id.toString()===this.pickupData.location&&t.vehicle.code===e.detail));this.pickupData=Object.assign(Object.assign({},this.pickupData),{due_upon_booking:this.pickupService.updateDue({amount:t.amount,code:t.pricing_model.code,numberOfPersons:this.numberOfPersons,number_of_vehicles:this.pickupData.number_of_vehicles}).toFixed(2),vehicle_type_code:t.vehicle.code})}updatePickupData(e,t){this.pickupData=Object.assign(Object.assign({},this.pickupData),{[e]:t})}async savePickup(){try{this.isLoading=true;const e=this.pickupService.validateForm(this.pickupData);console.log(e);if(e.error){this.cause=e.cause;return}if(this.cause){this.cause=null}}catch(e){console.error(e)}finally{this.isLoading=false}}render(){return i(l,{class:"p-0"},i("div",{class:"position-sticky mb-0 shadow-none p-0"},i("div",{class:"d-flex mt-2 align-items-center justify-content-between"},i("h3",{class:"card-title text-left pb-1 font-medium-2 px-2 px-md-3"},n.entries.Lcz_Pickup))),i("section",{class:"px-2 px-md-3"},i("ir-select",{onSelectChange:this.handleLocationChange.bind(this),firstOption:n.entries.Lcz_Pickup_NoThankYou,class:"m-0 ",LabelAvailable:false,data:a.pickup_service.allowed_locations.map((e=>({text:n.entries.Lcz_Pickup_YesFrom+" "+e.description,value:e.id})))}),this.pickupData.location&&i(s,null,i("div",{class:"d-flex"},i("div",{class:"form-group  mr-1"},i("div",{class:"input-group row m-0"},i("div",{class:`input-group-prepend col-5 p-0 text-dark border-0`},i("label",{class:`input-group-text  bg-light flex-grow-1 text-dark border-0 `},n.entries.Lcz_ArrivalDate)),i("div",{class:"form-control form-control-md col-7 d-flex align-items-center pl-0"},i("ir-date-picker",{minDate:c().format("YYYY-MM-DD"),autoApply:true,format:"ddd, DD M YYYY",singleDatePicker:true,onDateChanged:e=>{this.updatePickupData("arrival_date",e.detail.start.format("YYYY-MM-DD"))}})))),i("div",{class:"form-group"},i("div",{class:"input-group  row m-0"},i("div",{class:`input-group-prepend col-4 col-sm-3 p-0 text-dark border-0`},i("label",{htmlFor:"pickup",class:`input-group-text  bg-light flex-grow-1 text-dark border-0`},n.entries.Lcz_Time)),i("input",{value:this.pickupData.arrival_time,type:"text",id:"pickup-time",class:`form-control col-8 col-sm-4 ${this.cause==="arrival_time"&&"border-danger"}`})))),i("ir-input-text",{label:n.entries.Lcz_FlightDetails,onTextChange:e=>this.updatePickupData("flight_details",e.detail),placeholder:"",inputStyles:this.cause==="flight_details"?"border-danger":""}),i("ir-select",{selectStyles:this.cause==="vehicle_type_code"?"border-danger":"",onSelectChange:this.handleVehicleTypeChange.bind(this),firstOption:n.entries.Lcz_Select,selectedValue:this.pickupData.vehicle_type_code,class:"m-0",LabelAvailable:false,data:this.allowedOptionsByLocation.map((e=>({text:e.vehicle.description,value:e.vehicle.code})))}),i("div",{class:"d-flex flex-column flex-md-row"},i("ir-select",{selectStyles:this.cause==="number_of_vehicles"?"border-danger":"",selectedValue:this.pickupData.number_of_vehicles,labelWidth:6,class:"m-0  mb-md-0 mr-md-1 flex-fill",label:n.entries.Lcz_NbrOfVehicles,data:Array.from({length:this.vehicleCapacity+1},((e,t)=>t+1)).map((e=>({text:e,value:e})))}),i("ir-input-text",{readonly:true,value:this.pickupData.due_upon_booking,labelWidth:6,label:`${n.entries.Lcz_DueUponBooking}  ${this.pickupData.currency.symbol}`,placeholder:"",class:""}))),i("div",{class:"d-flex flex-column flex-md-row mt-3"},i("ir-button",{onClick:()=>this.closeModal.emit(null),btn_styles:"justify-content-center",class:`mb-1 mb-md-0  flex-fill ${this.pickupData.location?"mr-md-1":""}`,icon:"",text:n.entries.Lcz_Cancel,btn_color:"secondary"}),this.pickupData.location&&i("ir-button",{btn_styles:"justify-content-center align-items-center",class:"m-0 flex-fill text-center",icon:"",isLoading:this.isLoading,text:n.entries.Lcz_Save,btn_color:"primary",onClick:this.savePickup.bind(this)}))))}get el(){return r(this)}};h.style=u;export{h as ir_pickup};
//# sourceMappingURL=p-0ad78b7c.entry.js.map