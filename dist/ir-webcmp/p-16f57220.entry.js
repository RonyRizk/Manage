import{r as t,c as i,h as s,F as e,H as o,g as h}from"./p-05195efb.js";import{B as r}from"./p-c13df6722.js";import{l as a}from"./p-16d91b49.js";import{v as l}from"./p-d4c9256e.js";import"./p-eec37187.js";import"./p-fe6c3d31.js";import"./p-70521dff.js";const n=".sc-ir-autocomplete-h{display:block;position:relative}.selected.sc-ir-autocomplete{color:#fff;text-decoration:none;background-color:#666ee8}input.sc-ir-autocomplete{width:100%;position:relative}.combobox.sc-ir-autocomplete{margin:0;top:30px;min-width:100%;width:max-content;display:block;z-index:10000;padding:1px;background:white;box-shadow:0px 8px 16px 0px rgba(0, 0, 0, 0.2);padding:5px 0;max-height:250px;overflow-y:auto}.dropdown-item.sc-ir-autocomplete{cursor:pointer}button.sc-ir-autocomplete{all:unset;right:4px}.combobox.sc-ir-autocomplete p.sc-ir-autocomplete,span.sc-ir-autocomplete,loader-container.sc-ir-autocomplete{padding:5px 16px;margin:0px;margin-top:2px;width:100%}.combobox.sc-ir-autocomplete p.sc-ir-autocomplete{cursor:pointer}.combobox.sc-ir-autocomplete p.sc-ir-autocomplete:hover{background:#f4f5fa}.combobox.sc-ir-autocomplete p[data-selected].sc-ir-autocomplete,.combobox.sc-ir-autocomplete p[data-selected].sc-ir-autocomplete:hover{color:#fff;text-decoration:none;background-color:#666ee8}.loader.sc-ir-autocomplete{width:14px;height:14px;border:2px solid #0f0f0f;border-bottom-color:transparent;border-radius:50%;display:inline-block;box-sizing:border-box;animation:rotation 1s linear infinite}@keyframes rotation{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}";const c=class{constructor(s){t(this,s);this.comboboxValue=i(this,"comboboxValue",7);this.inputCleared=i(this,"inputCleared",7);this.toast=i(this,"toast",7);this.bookingService=new r;this.no_result_found="";this.duration=300;this.placeholder="";this.propertyId=undefined;this.isSplitBooking=false;this.type="text";this.name="";this.inputId=l();this.required=false;this.disabled=false;this.value=undefined;this.from_date="";this.to_date="";this.danger_border=undefined;this.inputValue="";this.data=[];this.selectedIndex=-1;this.isComboBoxVisible=false;this.isLoading=true;this.isItemSelected=undefined}componentWillLoad(){this.no_result_found=a.entries.Lcz_NoResultsFound}handleKeyDown(t){var i;const s=this.data.length;const e=this.getHeightOfPElement();if(s>0){switch(t.key){case"ArrowUp":t.preventDefault();this.selectedIndex=(this.selectedIndex-1+s)%s;this.adjustScrollPosition(e);break;case"ArrowDown":t.preventDefault();this.selectedIndex=(this.selectedIndex+1)%s;this.adjustScrollPosition(e);break;case"Enter":case" ":case"ArrowRight":t.preventDefault();this.selectItem(this.selectedIndex);break;case"Escape":(i=this.inputRef)===null||i===void 0?void 0:i.blur();this.isComboBoxVisible=false;break}}}getHeightOfPElement(){const t=this.el.querySelector(".combobox");if(t){const i=t.querySelector("p");return i?i.offsetHeight:0}return 0}adjustScrollPosition(t,i=250){const s=this.el.querySelector(".combobox");if(s){const e=2;const o=t+e;const h=o*this.selectedIndex;let r=h-i/2+t/2;r=Math.max(0,Math.min(r,s.scrollHeight-i));s.scrollTo({top:r,behavior:"auto"})}}selectItem(t){if(this.data[t]){this.isItemSelected=true;this.comboboxValue.emit({key:"select",data:this.data[t]});this.inputValue="";this.resetCombobox()}}debounceFetchData(){clearTimeout(this.debounceTimer);this.debounceTimer=setTimeout((()=>{this.fetchData()}),this.duration)}async fetchData(){try{this.isLoading=true;let t=[];if(!this.isSplitBooking){t=await this.bookingService.fetchExposedGuest(this.inputValue,this.propertyId)}else{if(this.inputValue.split(" ").length===1){t=await this.bookingService.fetchExposedBookings(this.inputValue,this.propertyId,this.from_date,this.to_date)}}this.data=t;if(!this.isComboBoxVisible){this.isComboBoxVisible=true}}catch(t){console.log("error",t)}finally{this.isLoading=false}}handleInputChange(t){this.inputValue=t.target.value;if(this.inputValue){this.debounceFetchData()}else{clearTimeout(this.debounceTimer);this.resetCombobox(false)}}handleDocumentClick(t){const i=t.target;if(!this.el.contains(i)){this.isComboBoxVisible=false}}handleBlur(){setTimeout((()=>{if(this.isDropdownItem(document.activeElement)){return}if(this.isSplitBooking){if(!this.isItemSelected){if(this.data.length>0){this.comboboxValue.emit({key:"blur",data:this.inputValue})}else{if(this.inputValue!==""){this.toast.emit({type:"error",description:"",title:`The Booking #${this.inputValue} is not Available`,position:"top-right"});this.inputCleared.emit()}}this.inputValue="";this.resetCombobox()}else{this.isItemSelected=false}}else{if(!this.isItemSelected){this.comboboxValue.emit({key:"blur",data:this.inputValue});this.inputValue="";this.resetCombobox()}else{this.isItemSelected=false}}}),200)}isDropdownItem(t){return t&&t.closest(".combobox")}disconnectedCallback(){var t,i,s,e;clearTimeout(this.debounceTimer);(t=this.inputRef)===null||t===void 0?void 0:t.removeEventListener("blur",this.handleBlur);(i=this.inputRef)===null||i===void 0?void 0:i.removeEventListener("click",this.selectItem);(s=this.inputRef)===null||s===void 0?void 0:s.removeEventListener("keydown",this.handleKeyDown);(e=this.inputRef)===null||e===void 0?void 0:e.removeEventListener("focus",this.handleFocus)}handleItemKeyDown(t,i){var s;if(t.key==="Enter"||t.key===" "||t.key==="ArrowRight"){this.selectItem(i);t.preventDefault()}else if(t.key==="Escape"){this.isComboBoxVisible=false;(s=this.inputRef)===null||s===void 0?void 0:s.blur();t.preventDefault()}else{return}}renderDropdown(){var t;if(this.inputValue!==""){return s("div",{class:`position-absolute border rounded combobox`},(t=this.data)===null||t===void 0?void 0:t.map(((t,i)=>s("p",{role:"button",onKeyDown:t=>this.handleItemKeyDown(t,i),"data-selected":this.selectedIndex===i,tabIndex:0,onClick:()=>this.selectItem(i)},this.isSplitBooking?s(e,null,`${t.booking_nbr} ${t.guest.first_name} ${t.guest.last_name}`):s("div",{class:"d-flex align-items-center flex-fill"},s("p",{class:"p-0 m-0"},`${t.email}`," ",s("span",{class:"p-0 m-0"},` - ${t.first_name} ${t.last_name}`)))))),this.isLoading&&s("div",{class:"loader-container d-flex align-items-center justify-content-center"},s("div",{class:"loader"})),this.data.length===0&&!this.isLoading&&s("span",{class:"text-center"},this.no_result_found))}}handleFocus(){this.isComboBoxVisible=true}clearInput(){this.inputValue="";this.resetCombobox();this.inputCleared.emit(null)}resetCombobox(t=true){var i;if(t){(i=this.inputRef)===null||i===void 0?void 0:i.blur()}this.data=[];this.selectedIndex=-1;this.isComboBoxVisible=false}render(){return s(o,null,s("div",{class:"d-flex align-items-center "},s("input",{required:this.required,disabled:this.disabled,id:this.inputId,onKeyDown:this.handleKeyDown.bind(this),class:`form-control input-sm flex-full ${this.danger_border&&"border-danger"}`,type:this.type,name:this.name,value:this.value||this.inputValue,placeholder:this.placeholder,onBlur:this.handleBlur.bind(this),onInput:this.handleInputChange.bind(this),onFocus:this.handleFocus.bind(this),ref:t=>this.inputRef=t}),this.inputValue&&s("button",{type:"button",class:"position-absolute d-flex align-items-center justify-content-center ",onClick:this.clearInput.bind(this)},s("p",{class:"sr-only"},"clear input"),s("svg",{width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},s("path",{d:"M11.7816 4.03157C12.0062 3.80702 12.0062 3.44295 11.7816 3.2184C11.5571 2.99385 11.193 2.99385 10.9685 3.2184L7.50005 6.68682L4.03164 3.2184C3.80708 2.99385 3.44301 2.99385 3.21846 3.2184C2.99391 3.44295 2.99391 3.80702 3.21846 4.03157L6.68688 7.49999L3.21846 10.9684C2.99391 11.193 2.99391 11.557 3.21846 11.7816C3.44301 12.0061 3.80708 12.0061 4.03164 11.7816L7.50005 8.31316L10.9685 11.7816C11.193 12.0061 11.5571 12.0061 11.7816 11.7816C12.0062 11.557 12.0062 11.193 11.7816 10.9684L8.31322 7.49999L11.7816 4.03157Z",fill:"currentColor","fill-rule":"evenodd","clip-rule":"evenodd"})))),this.isComboBoxVisible&&this.renderDropdown())}get el(){return h(this)}};c.style=n;export{c as ir_autocomplete};
//# sourceMappingURL=p-16f57220.entry.js.map