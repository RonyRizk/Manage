import{h as n}from"./p-fe6c3d31.js";import{i as o,e as T}from"./p-e0980810.js";import{a as E}from"./p-d0086f2b.js";import{l as t}from"./p-cda0b50c.js";import{c as _}from"./p-85d94cdd.js";async function O(n){const o=[];const T=await s();for(const E of n){for(const n of E.days){for(const E of n.room_types){A(E.physicalrooms,o,T)}}}return o}function A(n,o,T){for(const E of n){for(const n in E.calendar_cell){if(E.calendar_cell[n].Is_Available===false){R(E.calendar_cell[n],o,T)}}}}const r={"004":"BLOCKED","003":"BLOCKED-WITH-DATES","002":"BLOCKED"};const D={"000":"IN-HOUSE","001":"PENDING-CONFIRMATION","002":"CONFIRMED","003":"CHECKED-OUT"};function c(n,o){if(n===null&&o===null)return"";if(o!==null&&o!==""){return`${n!==null&&n!==void 0?n:""} , ${o!==null&&o!==void 0?o:""}`}return n}async function s(){try{const n=_.token;if(n){const{data:o}=await E.post(`/Get_Setup_Entries_By_TBL_NAME_Multi?Ticket=${n}`,{TBL_NAMES:["_STAY_STATUS"]});return o.My_Result.map((n=>({code:n.CODE_NAME,value:n.CODE_VALUE_EN})))}else{throw new Error("Invalid Token")}}catch(n){console.log(n)}}function e(o,T,E){const _=new Date(o);_.setHours(T);_.setMinutes(E);return`${t.entries.Lcz_BlockedTill} ${n(_).format("MMM DD, HH:mm")}`}function i(E,t){var _,O;if(o(E.STAY_STATUS_CODE)){const o=n(E.My_Block_Info.from_date,"YYYY-MM-DD").isAfter(E.DATE)?E.My_Block_Info.from_date:E.DATE;const _=n(E.My_Block_Info.to_date,"YYYY-MM-DD").isAfter(E.DATE)?E.My_Block_Info.to_date:E.DATE;return{ID:E.POOL,NOTES:"",BALANCE:"",NAME:E.My_Block_Info.NOTES!==""?E.My_Block_Info.NOTES:E.STAY_STATUS_CODE==="003"?e(E.My_Block_Info.BLOCKED_TILL_DATE,E.My_Block_Info.BLOCKED_TILL_HOUR,E.My_Block_Info.BLOCKED_TILL_MINUTE):t.find((n=>n.code===E.STAY_STATUS_CODE)).value||"",RELEASE_AFTER_HOURS:E.My_Block_Info.DESCRIPTION,PR_ID:E.My_Block_Info.pr_id,ENTRY_DATE:E.My_Block_Info.BLOCKED_TILL_DATE,ENTRY_HOUR:E.My_Block_Info.BLOCKED_TILL_HOUR,ENTRY_MINUTE:E.My_Block_Info.BLOCKED_TILL_MINUTE,OPTIONAL_REASON:E.My_Block_Info.NOTES,FROM_DATE:o,TO_DATE:_,NO_OF_DAYS:T(o,_),STATUS:r[E.STAY_STATUS_CODE],POOL:E.POOL,STATUS_CODE:E.STAY_STATUS_CODE,OUT_OF_SERVICE:E.STAY_STATUS_CODE==="004",FROM_DATE_STR:E.My_Block_Info.format.from_date,TO_DATE_STR:E.My_Block_Info.format.to_date}}if(E.booking.booking_nbr==="57243250"){console.log("cell");console.log(n(E.room.from_date,"YYYY-MM-DD").isAfter(E.DATE)?E.room.from_date:E.DATE);console.log(E)}const A=n(E.room.from_date,"YYYY-MM-DD").isAfter(E.DATE)?E.room.from_date:E.DATE;const s=n(E.room.to_date,"YYYY-MM-DD").isAfter(E.DATE)?E.room.to_date:E.DATE;return{ID:E.POOL,FROM_DATE:A,TO_DATE:s,NO_OF_DAYS:T(A,s),STATUS:D[(_=E.booking)===null||_===void 0?void 0:_.status.code],NAME:c(E.room.guest.first_name,E.room.guest.last_name),IDENTIFIER:E.room.identifier,PR_ID:E.pr_id,POOL:E.POOL,BOOKING_NUMBER:E.booking.booking_nbr,NOTES:E.booking.is_direct?E.booking.remark:null,is_direct:E.booking.is_direct,BALANCE:(O=E.booking.financial)===null||O===void 0?void 0:O.due_amount,channel_booking_nbr:E.booking.channel_booking_nbr,ARRIVAL_TIME:E.booking.arrival.description}}function R(n,o,T){const E=o.findIndex((o=>o.POOL===n.POOL));if(E===-1){const E=i(n,T);o.push(E)}}function N(o){let T=[];const E=T=>{const E=n();const t=n(T.to_date,"YYYY-MM-DD");const _=n(T.from_date,"YYYY-MM-DD");if(_.isSame(E,"day")&&E.hour()>=12){return D["000"]}else if(E.isAfter(_,"day")&&E.isBefore(t,"day")){return D["000"]}else if(t.isSame(E,"day")&&E.hour()<12){return D["000"]}else if(t.isSame(E,"day")&&E.hour()>=12||t.isBefore(E,"day")){return D["003"]}else{return D[(o===null||o===void 0?void 0:o.status.code)||"001"]}};const t=o.rooms.filter((n=>!!n["assigned_units_pool"]));t.forEach((n=>{var t,_;T.push({ID:n["assigned_units_pool"],TO_DATE:n.to_date,FROM_DATE:n.from_date,NO_OF_DAYS:n.days.length,ARRIVAL:o.arrival,IS_EDITABLE:true,BALANCE:(t=o.financial)===null||t===void 0?void 0:t.due_amount,STATUS:E(n),NAME:c(n.guest.first_name,n.guest.last_name),PHONE:(_=o.guest.mobile)!==null&&_!==void 0?_:"",ENTRY_DATE:"12-12-2023",RATE:n.total,RATE_PLAN:n.rateplan.name,SPLIT_BOOKING:false,RATE_PLAN_ID:n.rateplan.id,IDENTIFIER:n.identifier,RATE_TYPE:n.roomtype.id,ADULTS_COUNT:n.occupancy.adult_nbr,CHILDREN_COUNT:n.occupancy.children_nbr,PR_ID:+n.unit.id,POOL:n["assigned_units_pool"],GUEST:o.guest,ROOMS:o.rooms,BOOKING_NUMBER:o.booking_nbr,cancelation:n.rateplan.cancelation,guarantee:n.rateplan.guarantee,TOTAL_PRICE:n.gross_total,COUNTRY:o.guest.country_id,FROM_DATE_STR:o.format.from_date,TO_DATE_STR:o.format.to_date,adult_child_offering:n.rateplan.selected_variation.adult_child_offering,ARRIVAL_TIME:o.arrival.description,origin:o.origin,channel_booking_nbr:o.channel_booking_nbr,is_direct:o.is_direct,NOTES:o.is_direct?o.remark:null,SOURCE:{code:o.source.code,description:o.source.description,tag:o.source.tag},ota_notes:o.ota_notes})}));return T}async function a(n){const o=await s();return{ID:n.POOL,NOTES:"",BALANCE:"",NAME:n.NOTES!==""?n.NOTES:n.STAY_STATUS_CODE==="003"?e(n.BLOCKED_TILL_DATE,n.BLOCKED_TILL_HOUR,n.BLOCKED_TILL_MINUTE):o.find((o=>o.code===n.STAY_STATUS_CODE)).value||"",RELEASE_AFTER_HOURS:n.DESCRIPTION,PR_ID:n.pr_id,ENTRY_DATE:n.BLOCKED_TILL_DATE,ENTRY_HOUR:n.BLOCKED_TILL_HOUR,ENTRY_MINUTE:n.BLOCKED_TILL_MINUTE,OPTIONAL_REASON:n.NOTES,FROM_DATE:n.from_date,TO_DATE:n.to_date,NO_OF_DAYS:Y(n.from_date,n.to_date),STATUS:r[n.STAY_STATUS_CODE],POOL:n.POOL,STATUS_CODE:n.STAY_STATUS_CODE,OUT_OF_SERVICE:n.STAY_STATUS_CODE==="004",FROM_DATE_STR:n.format.from_date,TO_DATE_STR:n.format.to_date}}function Y(o,T){const E=n(o,"YYYY-MM-DD");const t=n(T,"YYYY-MM-DD");const _=t.diff(E,"days");return _||1}export{N as a,D as b,Y as c,c as f,O as g,a as t};
//# sourceMappingURL=p-4f666bdc.js.map