import{h as n,i as T,e as E}from"./p-34fcab72.js";import{a as t}from"./p-539b691e.js";import{l as o}from"./p-dda5a727.js";async function _(n){const T=[];const E=await i();for(const t of n){for(const n of t.days){for(const t of n.room_types){O(t.physicalrooms,T,E)}}}return T}function O(n,T,E){for(const t of n){for(const n in t.calendar_cell){if(t.calendar_cell[n].Is_Available===false){D(t.calendar_cell[n],T,E)}}}}const A={"004":"BLOCKED","003":"BLOCKED-WITH-DATES","002":"BLOCKED"};const r={"000":"IN-HOUSE","001":"PENDING-CONFIRMATION","002":"CONFIRMED","003":"CHECKED-OUT"};function e(n,T){if(n===null&&T===null)return"";if(T!==null){return`${n!==null&&n!==void 0?n:""} , ${T!==null&&T!==void 0?T:""}`}return n}async function i(){try{const n=JSON.parse(sessionStorage.getItem("token"));if(n){const{data:T}=await t.post(`/Get_Setup_Entries_By_TBL_NAME_Multi?Ticket=${n}`,{TBL_NAMES:["_STAY_STATUS"]});return T.My_Result.map((n=>({code:n.CODE_NAME,value:n.CODE_VALUE_EN})))}else{throw new Error("Invalid Token")}}catch(n){console.log(n)}}function s(T,E,t){const _=new Date(T);_.setHours(E);_.setMinutes(t);return`${o.entries.Lcz_BlockedTill} ${n(_).format("MMM DD, HH:mm")}`}function R(n,E){var t,o;if(T(n.STAY_STATUS_CODE)){return{ID:n.POOL,NOTES:"",BALANCE:"",NAME:n.My_Block_Info.NOTES!==""?n.My_Block_Info.NOTES:n.STAY_STATUS_CODE==="003"?s(n.My_Block_Info.BLOCKED_TILL_DATE,n.My_Block_Info.BLOCKED_TILL_HOUR,n.My_Block_Info.BLOCKED_TILL_MINUTE):E.find((T=>T.code===n.STAY_STATUS_CODE)).value||"",RELEASE_AFTER_HOURS:n.My_Block_Info.DESCRIPTION,PR_ID:n.My_Block_Info.pr_id,ENTRY_DATE:n.My_Block_Info.BLOCKED_TILL_DATE,ENTRY_HOUR:n.My_Block_Info.BLOCKED_TILL_HOUR,ENTRY_MINUTE:n.My_Block_Info.BLOCKED_TILL_MINUTE,OPTIONAL_REASON:n.My_Block_Info.NOTES,FROM_DATE:n.DATE,TO_DATE:n.DATE,NO_OF_DAYS:1,STATUS:A[n.STAY_STATUS_CODE],POOL:n.POOL,STATUS_CODE:n.STAY_STATUS_CODE,OUT_OF_SERVICE:n.STAY_STATUS_CODE==="004",FROM_DATE_STR:n.My_Block_Info.format.from_date,TO_DATE_STR:n.My_Block_Info.format.to_date}}return{ID:n.POOL,TO_DATE:n.DATE,FROM_DATE:n.DATE,NO_OF_DAYS:1,STATUS:r[(t=n.booking)===null||t===void 0?void 0:t.status.code],NAME:e(n.room.guest.first_name,n.room.guest.last_name),IDENTIFIER:n.room.identifier,PR_ID:n.pr_id,POOL:n.POOL,BOOKING_NUMBER:n.booking.booking_nbr,NOTES:n.booking.remark,is_direct:n.booking.is_direct,BALANCE:(o=n.booking.financial)===null||o===void 0?void 0:o.due_amount}}function c(n,T){n.NO_OF_DAYS=E(n.FROM_DATE,T.DATE);n.TO_DATE=T.DATE;if(T.booking){const{arrival:E}=T.booking;Object.assign(n,{ARRIVAL_TIME:E.description})}return n}function D(n,T,E){const t=T.findIndex((T=>T.POOL===n.POOL));if(t===-1){const t=R(n,E);T.push(t)}else{const E=c(T[t],n);T[t]=E}}function a(T){let E=[];const t=E=>{const t=n();const o=n(E.to_date,"YYYY-MM-DD");const _=n(E.from_date,"YYYY-MM-DD");if(_.isSame(t,"day")&&t.hour()>=12){return r["000"]}else if(t.isAfter(_,"day")&&t.isBefore(o,"day")){return r["000"]}else if(o.isSame(t,"day")&&t.hour()<12){return r["000"]}else if(o.isSame(t,"day")&&t.hour()>=12||o.isBefore(t,"day")){return r["003"]}else{return r[(T===null||T===void 0?void 0:T.status.code)||"001"]}};const o=T.rooms.filter((n=>!!n["assigned_units_pool"]));o.forEach((n=>{var o,_;E.push({ID:n["assigned_units_pool"],TO_DATE:n.to_date,FROM_DATE:n.from_date,NO_OF_DAYS:n.days.length,ARRIVAL:T.arrival,IS_EDITABLE:true,BALANCE:(o=T.financial)===null||o===void 0?void 0:o.due_amount,STATUS:t(n),NAME:e(n.guest.first_name,n.guest.last_name),PHONE:(_=T.guest.mobile)!==null&&_!==void 0?_:"",ENTRY_DATE:"12-12-2023",RATE:n.total,RATE_PLAN:n.rateplan.name,SPLIT_BOOKING:false,RATE_PLAN_ID:n.rateplan.id,IDENTIFIER:n.identifier,RATE_TYPE:n.roomtype.id,ADULTS_COUNT:n.occupancy.adult_nbr,CHILDREN_COUNT:n.occupancy.children_nbr,PR_ID:+n.unit.id,POOL:n["assigned_units_pool"],GUEST:T.guest,ROOMS:T.rooms,BOOKING_NUMBER:T.booking_nbr,cancelation:n.rateplan.cancelation,guarantee:n.rateplan.guarantee,TOTAL_PRICE:n.total,COUNTRY:T.guest.country_id,FROM_DATE_STR:T.format.from_date,TO_DATE_STR:T.format.to_date,adult_child_offering:n.rateplan.selected_variation.adult_child_offering,ARRIVAL_TIME:T.arrival.description,origin:T.origin,channel_booking_nbr:T.channel_booking_nbr,is_direct:T.is_direct,NOTES:T.remark,SOURCE:{code:T.source.code,description:T.source.description,tag:T.source.tag}})}));return E}async function N(n){const T=await i();return{ID:n.POOL,NOTES:"",BALANCE:"",NAME:n.NOTES!==""?n.NOTES:n.STAY_STATUS_CODE==="003"?s(n.BLOCKED_TILL_DATE,n.BLOCKED_TILL_HOUR,n.BLOCKED_TILL_MINUTE):T.find((T=>T.code===n.STAY_STATUS_CODE)).value||"",RELEASE_AFTER_HOURS:n.DESCRIPTION,PR_ID:n.pr_id,ENTRY_DATE:n.BLOCKED_TILL_DATE,ENTRY_HOUR:n.BLOCKED_TILL_HOUR,ENTRY_MINUTE:n.BLOCKED_TILL_MINUTE,OPTIONAL_REASON:n.NOTES,FROM_DATE:n.from_date,TO_DATE:n.to_date,NO_OF_DAYS:S(n.from_date,n.to_date),STATUS:A[n.STAY_STATUS_CODE],POOL:n.POOL,STATUS_CODE:n.STAY_STATUS_CODE,OUT_OF_SERVICE:n.STAY_STATUS_CODE==="004",FROM_DATE_STR:n.format.from_date,TO_DATE_STR:n.format.to_date}}function S(T,E){const t=n(T,"YYYY-MM-DD");const o=n(E,"YYYY-MM-DD");const _=o.diff(t,"days");return _}export{a,r as b,S as c,e as f,_ as g,N as t};
//# sourceMappingURL=p-eaccab4c.js.map