{"version":3,"names":["EventsService","Token","constructor","this","bookingService","BookingService","reallocateEvent","pool","destination_pr_id","from_date","to_date","token","getToken","console","log","data","axios","post","ExceptionMsg","Error","error","deleteEvent","POOL","My_Result","updateBlockedEvent","bookingEvent","releaseData","getReleaseHoursString","RELEASE_AFTER_HOURS","setToken","result","blockUnit","Object","assign","formatDate","FROM_DATE","TO_DATE","pr_id","PR_ID","STAY_STATUS_CODE","OUT_OF_SERVICE","DESCRIPTION","NOTES","OPTIONAL_REASON","date","split","join","iglBookingEventCss","IglBookingEvent","dayWidth","eventSpace","vertSpace","showInfoPopup","bubbleInfoTopSide","isStreatch","eventsService","resizeSide","isDragging","animationFrameId","handleMouseMoveBind","handleMouseMove","bind","handleMouseUpBind","handleMouseUp","handleClickOutsideBind","handleClickOutside","componentWillLoad","calendar_data","window","addEventListener","fetchAndAssignBookingData","BOOKING_NUMBER","includes","STATUS","getExposedBooking","dataForTransformation","rooms","filter","d","ID","length","some","r","_a","transformNewBooking","others","__rest","showEventInfo","componentDidLoad","isNewEvent","hideBubble","setTimeout","async","STATUS_CODE","renderAgain","disconnectedCallback","removeEventListener","cancelAnimationFrame","event","clickedElement","target","element","contains","hideBubbleInfoPopup","detail","currentInfoBubbleId","getBookingId","key","moveBookingToHandler","bookingId","moveToDay","toRoomId","fromRoomId","isTouchStart","moveDiffereneX","moveDiffereneY","isBlockUnit","requestAnimationFrame","resetBookingToInitialPosition","checkIfSlotOccupied","catch","isShrinking","toString","description","status","setModalDescription","hideConfirmButton","showDialog","emit","title","showRoomNightsDialog","bookingNumber","identifier","IDENTIFIER","toast","position","message","type","findRoomType","roomId","roomType","roomsInfo","room","physicalrooms","id","is_direct","locales","entries","Lcz_YouWillLoseFutureUpdates","moment","isSame","initialRT","targetRT","Lcz_AreYouSureWantToMoveAnotherUnit","origin","Label","Lcz_SameRatesWillBeKept","Lcz_CannotChangeCHBookings","Lcz_BalanceWillBeCalculated","style","left","initialLeft","width","initialWidth","finalWidth","top","dragInitPos","handleRevertBooking","fromTime","toTime","isOccupied","allBookingEvents","eventFromTime","add","eventToTime","isSameOrAfter","isBefore","renderElement","getUniqueId","Date","getTime","isSplitBooking","SPLIT_BOOKING","isHighlightEventType","getEventType","getBookingStatus","getBookedBy","NAME","getBookedRoomId","getEventStartingDate","getEventEndingDate","event_type","getEventLegend","legendData","statusId","orderRide","color","_b","getLegendOfStatus","aStatusId","getNoteNode","INTERNAL_NOTE","getBalanceNode","BALANCE","setStayDays","aStayDays","NO_OF_DAYS","getStayDays","getPosition","startingDate","startingCellClass","getDate","getMonth","getFullYear","bodyContainer","document","querySelector","startingCell","pos","height","getBoundingClientRect","bodyContainerRect","boundingRect","getNumber","aData","parseFloat","startDragging","side","preventDefault","stopPropagation","stopImmediatePropagation","initialX","clientX","touches","initialY","clientY","elementRect","offsetX","offsetY","x","y","dragEndPos","dragOverEventData","offsetWidth","offsetLeft","currentX","distanceX","currentY","distanceY","newWidth","Math","min","max","newLeft","abs","nbOfDays","numberOfDays","round","initialStayDays","isNaN","replace","updateData","updateEventData","renderEventBookingNumber","channel_booking_nbr","showInfo","midPoint","hideBubbleInfo","render","legend","noteNode","balanceNode","h","Host","class","clsName","backgroundColor","onTouchStart","onMouseDown","Fragment","is_vacation_rental","countryNodeList","currency","bubbleInfoTop","iglBookingEventHoverCss","IglBookingEventHover","todayTimeStamp","setHours","eventService","hideButtons","selectedRt","find","RATE_TYPE","shouldHideUnassignUnit","handleKeyDown","getTotalOccupants","ADULTS_COUNT","getPhoneNumber","PHONE","getCountry","findCountry","COUNTRY","name","getPhoneCode","phone_prefix","renderPhone","getGuestNote","getInternalNote","getTotalPrice","TOTAL_PRICE","getCheckInDate","FROM_DATE_STR","getCheckOutDate","TO_DATE_STR","getArrivalTime","ARRIVAL_TIME","getRatePlan","RATE_PLAN","getEntryDate","ENTRY_DATE","getReleaseAfterHours","isNewBooking","isCheckedIn","isCheckedOut","isBlockedDateEvent","getRoomId","getCategoryByRoomId","roomCategory","hasSplitBooking","hasOwnProperty","splitBookingEvents","canCheckIn","fromTimeStamp","dt","toTimeStamp","canCheckOut","handleBlockDateUpdate","opt","handleEditBooking","TITLE","Lcz_EditBookingFor","handleBookingOption","getStringDateFormat","handleAddRoom","fromDate","from_date_str","toDate","to_date_str","eventData","ARRIVAL","ADD_ROOM_TO_BOOKING","ROOMS","GUEST","SOURCE","defaultDateRange","fromDateStr","toDateStr","dateDifference","editabled","handleCustomerCheckIn","handleCustomerCheckOut","handleDeleteEvent","deleteButton","handleUpdateBlockedDates","isLoading","handleConvertBlockedDateToBooking","getRoomInfo","roomIdToFind","selectedRoom","physicalRoom","CATEGORY","ROOM_NAME","ROOMS_INFO","renderTitle","eventType","roomInfo","Lcz_AddingUnitToBooking","Lcz_Adding","Lcz_NewBookingFor","roomData","showBookingPopup","renderNote","ota_notes","guestNote","noteLabel","Lcz_Note","label","remarks","getInfoElement","src","Icon","alt","getCurrencySymbol","code","showDateDifference","Lcz_ArrivalTime","Lcz_Occupancy","Lcz_Phone","Lcz_RatePlan","Lcz_InternalRemark","role","onClick","_","disabled","IS_EDITABLE","xmlns","fill","stroke","viewBox","Lcz_Edit","Lcz_AddRoom","Lcz_Unassign","getNewBookingOptions","shouldDisplayButtons","rateplans","rate","is_active","Lcz_CreateNewBooking","Lcz_AssignUnitToExistingBooking","Lcz_NoRatePlanDefined","Lcz_Blockdates","getBlockedView","isEventHover","entryHour","ENTRY_HOUR","entryMinute","ENTRY_MINUTE","defaultData","format","entryDate","onDataUpdateEvent","Lcz_Update","Lcz_ConvertToBooking","Lcz_Delete","irPopoverCss","IrPopover","handleMouseEnter","showPopover","isHovered","handleMouseLeave","checkTitleWidth","titleElement","el","scrollWidth","irPopoverLeft","onMouseLeave","onMouseEnter","popoverTitle"],"sources":["src/services/events.service.ts","src/components/igloo-calendar/igl-booking-event/igl-booking-event.css?tag=igl-booking-event&encapsulation=scoped","src/components/igloo-calendar/igl-booking-event/igl-booking-event.tsx","src/components/igloo-calendar/igl-booking-event-hover/igl-booking-event-hover.css?tag=igl-booking-event-hover&encapsulation=scoped","src/components/igloo-calendar/igl-booking-event-hover/igl-booking-event-hover.tsx","src/components/ir-popover/ir-popover.css?tag=ir-popover&encapsulation=scoped","src/components/ir-popover/ir-popover.tsx"],"sourcesContent":["import axios from 'axios';\r\nimport { BookingService } from './booking.service';\r\nimport { getReleaseHoursString } from '../utils/utils';\r\nimport { Token } from '@/models/Token';\r\n\r\nexport class EventsService extends Token {\r\n  private readonly bookingService: BookingService = new BookingService();\r\n  async reallocateEvent(pool: string, destination_pr_id: number, from_date: string, to_date: string) {\r\n    try {\r\n      const token = this.getToken();\r\n      if (token) {\r\n        console.log(pool, destination_pr_id, from_date, to_date);\r\n        const { data } = await axios.post(`/ReAllocate_Exposed_Room?Ticket=${token}`, { pool, destination_pr_id, from_date, to_date });\r\n        if (data.ExceptionMsg !== '') {\r\n          throw new Error(data.ExceptionMsg);\r\n        }\r\n        console.log(data);\r\n        return data;\r\n      } else {\r\n        throw new Error('Invalid Token');\r\n      }\r\n    } catch (error) {\r\n      console.error(error);\r\n      throw new Error(error);\r\n    }\r\n  }\r\n  public async deleteEvent(POOL: string) {\r\n    try {\r\n      const token = this.getToken();\r\n      if (token) {\r\n        const { data } = await axios.post(`/UnBlock_Exposed_Unit?Ticket=${token}`, {\r\n          POOL,\r\n        });\r\n        if (data.ExceptionMsg !== '') {\r\n          throw new Error(data.ExceptionMsg);\r\n        }\r\n        return data.My_Result;\r\n      } else {\r\n        throw new Error('Invalid Token');\r\n      }\r\n    } catch (error) {\r\n      console.log(error);\r\n      throw new Error(error);\r\n    }\r\n  }\r\n\r\n  public async updateBlockedEvent(bookingEvent: any) {\r\n    try {\r\n      const token = this.getToken();\r\n      if (token) {\r\n        const releaseData = getReleaseHoursString(+bookingEvent.RELEASE_AFTER_HOURS);\r\n        await this.deleteEvent(bookingEvent.POOL);\r\n        this.bookingService.setToken(token);\r\n        const result = await this.bookingService.blockUnit({\r\n          from_date: this.formatDate(bookingEvent.FROM_DATE),\r\n          to_date: this.formatDate(bookingEvent.TO_DATE),\r\n          pr_id: bookingEvent.PR_ID,\r\n          STAY_STATUS_CODE: bookingEvent.OUT_OF_SERVICE ? '004' : bookingEvent.RELEASE_AFTER_HOURS === 0 ? '002' : '003',\r\n          DESCRIPTION: bookingEvent.RELEASE_AFTER_HOURS || '',\r\n          NOTES: bookingEvent.OPTIONAL_REASON || '',\r\n          ...releaseData,\r\n        });\r\n        return result;\r\n      } else {\r\n        throw new Error('Invalid Token');\r\n      }\r\n    } catch (error) {\r\n      console.error(error);\r\n      throw new Error(error);\r\n    }\r\n  }\r\n  private formatDate(date: string) {\r\n    return date.split('/').join('-');\r\n  }\r\n}\r\n",":host {\r\n  display: block;\r\n  position: absolute;\r\n}\r\n\r\n.bookingEventBase {\r\n  position: absolute;\r\n  background-color: rgb(49, 190, 241);\r\n  width: 100%;\r\n  height: 100%;\r\n  transform: skewX(-22deg);\r\n  border-radius: 4px;\r\n}\r\n.bookingEvent {\r\n  cursor: pointer;\r\n}\r\n.bookingEventBase {\r\n  cursor: pointer;\r\n}\r\n.bookingEventHiddenBase {\r\n  position: absolute;\r\n  top: 0;\r\n  left: -4px;\r\n  width: calc(100% + 8);\r\n}\r\n\r\n.bookingEventDragHandle {\r\n  position: absolute;\r\n  top: 0;\r\n  width: 15px;\r\n  height: 100%;\r\n  opacity: 0.1;\r\n  background-color: rgba(0, 0, 0, 0.15);\r\n  transform: skewX(-22deg);\r\n  border-radius: 4px;\r\n  /* display: none; */\r\n  cursor: pointer;\r\n}\r\n\r\n.splitBooking {\r\n  border-right: 2px solid #000000;\r\n}\r\n\r\n:host:hover .bookingEventDragHandle {\r\n  display: block;\r\n  opacity: 1;\r\n}\r\n\r\n:host.newEvent:hover .bookingEventDragHandle {\r\n  display: none;\r\n  opacity: 1;\r\n}\r\n\r\n.leftSide {\r\n  left: 0;\r\n}\r\n\r\n.rightSide {\r\n  right: 0;\r\n}\r\n\r\n.bookingEventTitle {\r\n  color: #fff;\r\n  font-size: 0.8em;\r\n  position: relative;\r\n  max-width: calc(100% - 10px);\r\n  overflow: hidden;\r\n  text-overflow: ellipsis;\r\n  top: 2px;\r\n  left: 5px;\r\n  -webkit-user-select: none;\r\n  user-select: none;\r\n  -webkit-user-drag: none;\r\n  cursor: pointer;\r\n}\r\n\r\n.legend_circle {\r\n  border-radius: 100%;\r\n  width: 10px;\r\n  height: 10px;\r\n  margin: 3px 3px 3px 2px;\r\n  border: 1px solid #fff;\r\n}\r\n\r\n.noteIcon {\r\n  position: absolute;\r\n  bottom: -8px;\r\n  left: 2px;\r\n}\r\n\r\n.balanceIcon {\r\n  position: absolute;\r\n  top: -8px;\r\n  right: 2px;\r\n}\r\n","import { Component, Element, Event, EventEmitter, Fragment, Host, Listen, Prop, State, h } from '@stencil/core';\r\nimport { BookingService } from '@/services/booking.service';\r\nimport { transformNewBooking } from '@/utils/booking';\r\nimport { isBlockUnit } from '@/utils/utils';\r\nimport { IReallocationPayload, IRoomNightsData } from '@/models/property-types';\r\nimport moment from 'moment';\r\nimport { IToast } from '@components/ir-toast/toast';\r\nimport { EventsService } from '@/services/events.service';\r\nimport locales from '@/stores/locales.store';\r\nimport calendar_data from '@/stores/calendar-data';\r\n\r\n@Component({\r\n  tag: 'igl-booking-event',\r\n  styleUrl: 'igl-booking-event.css',\r\n  scoped: true,\r\n})\r\nexport class IglBookingEvent {\r\n  @Element() private element: HTMLElement;\r\n\r\n  @Prop() currency;\r\n  @Prop() is_vacation_rental: boolean = false;\r\n  @Prop() language: string;\r\n  @Prop({ mutable: true }) bookingEvent: { [key: string]: any };\r\n  @Prop() allBookingEvents: { [key: string]: any } = [];\r\n  @Prop() countryNodeList;\r\n\r\n  @Event({ bubbles: true, composed: true }) hideBubbleInfo: EventEmitter;\r\n  @Event() updateEventData: EventEmitter;\r\n  @Event() dragOverEventData: EventEmitter;\r\n  @Event() showRoomNightsDialog: EventEmitter<IRoomNightsData>;\r\n  @Event() showDialog: EventEmitter<IReallocationPayload>;\r\n  @Event() resetStreachedBooking: EventEmitter<string>;\r\n  @Event() toast: EventEmitter<IToast>;\r\n\r\n  @State() renderElement: boolean = false;\r\n  @State() position: { [key: string]: any };\r\n  @State() isShrinking: boolean | null = null;\r\n\r\n  dayWidth: number = 0;\r\n  eventSpace: number = 8;\r\n\r\n  vertSpace: number = 10;\r\n\r\n  /* show bubble */\r\n  private showInfoPopup: boolean = false;\r\n  private bubbleInfoTopSide: boolean = false;\r\n  private isStreatch = false;\r\n  /*Services */\r\n  private eventsService = new EventsService();\r\n  private bookingService = new BookingService();\r\n  /* Resize props */\r\n  resizeSide: string = '';\r\n  isDragging: boolean = false;\r\n  initialX: number;\r\n  initialY: number;\r\n  currentX: number;\r\n  currentY: number;\r\n  initialWidth: number;\r\n  initialLeft: number;\r\n  finalWidth: number;\r\n  dragInitPos: { [key: string]: any };\r\n  dragEndPos: { [key: string]: any };\r\n  elementRect: { [key: string]: any };\r\n  isTouchStart: boolean;\r\n  moveDiffereneX: number;\r\n  moveDiffereneY: number;\r\n  private animationFrameId: number | null = null;\r\n\r\n  handleMouseMoveBind = this.handleMouseMove.bind(this);\r\n  handleMouseUpBind = this.handleMouseUp.bind(this);\r\n  handleClickOutsideBind = this.handleClickOutside.bind(this);\r\n\r\n  componentWillLoad() {\r\n    this.bookingService.setToken(calendar_data.token);\r\n    this.eventsService.setToken(calendar_data.token);\r\n\r\n    window.addEventListener('click', this.handleClickOutsideBind);\r\n  }\r\n\r\n  async fetchAndAssignBookingData() {\r\n    try {\r\n      console.log('clicked on book#', this.bookingEvent.BOOKING_NUMBER);\r\n      if (['IN-HOUSE', 'CONFIRMED', 'PENDING-CONFIRMATION', 'CHECKED-OUT'].includes(this.bookingEvent.STATUS)) {\r\n        const data = await this.bookingService.getExposedBooking(this.bookingEvent.BOOKING_NUMBER, 'en');\r\n        let dataForTransformation = data.rooms.filter(d => d['assigned_units_pool'] === this.bookingEvent.ID);\r\n        data.rooms = dataForTransformation;\r\n        if (data.rooms.length === 0) {\r\n          throw new Error(`\"booking#${this.bookingEvent.BOOKING_NUMBER} have empty array\"`);\r\n        } else {\r\n          if (data.rooms.some(r => r['assigned_units_pool'] === null)) {\r\n            throw new Error(`\"booking#${this.bookingEvent.BOOKING_NUMBER} have empty pool\"`);\r\n          }\r\n        }\r\n        const { ID, TO_DATE, FROM_DATE, NO_OF_DAYS, STATUS, NAME, IDENTIFIER, PR_ID, POOL, BOOKING_NUMBER, NOTES, is_direct, BALANCE, ...others } = transformNewBooking(data)[0];\r\n\r\n        this.bookingEvent = { ...this.bookingEvent, ...others };\r\n        this.showEventInfo(true);\r\n      }\r\n    } catch (error) {\r\n      console.error(error);\r\n    }\r\n  }\r\n  componentDidLoad() {\r\n    if (this.isNewEvent()) {\r\n      if (!this.bookingEvent.hideBubble) {\r\n        /* auto matically open the popup, calling the method shows bubble either top or bottom based on available space. */\r\n        setTimeout(async () => {\r\n          if (['003', '002', '004'].includes(this.bookingEvent.STATUS_CODE)) {\r\n            this.showEventInfo(true);\r\n          } else if (['IN-HOUSE', 'CONFIRMED', 'PENDING-CONFIRMATION', 'CHECKED-OUT'].includes(this.bookingEvent.STATUS)) {\r\n            await this.fetchAndAssignBookingData();\r\n          } else {\r\n            this.showEventInfo(true);\r\n          }\r\n          this.renderAgain();\r\n        }, 1);\r\n      }\r\n    }\r\n  }\r\n\r\n  disconnectedCallback() {\r\n    window.removeEventListener('click', this.handleClickOutsideBind);\r\n    if (this.animationFrameId) {\r\n      cancelAnimationFrame(this.animationFrameId);\r\n    }\r\n  }\r\n\r\n  @Listen('click', { target: 'window' })\r\n  handleClickOutside(event: Event) {\r\n    const clickedElement = event.target as HTMLElement;\r\n    // Check if the clicked element is not within the target div\r\n    if (!this.element.contains(clickedElement)) {\r\n      // The click occurred outside the target div\r\n      this.showEventInfo(false);\r\n    }\r\n  }\r\n\r\n  @Listen('hideBubbleInfo', { target: 'window' })\r\n  hideBubbleInfoPopup(event: CustomEvent) {\r\n    if (event.detail.currentInfoBubbleId != this.getBookingId() || (event.detail.key === 'hidebubble' && event.detail.currentInfoBubbleId === this.getBookingId())) {\r\n      this.showInfoPopup = false;\r\n      this.renderAgain();\r\n    }\r\n  }\r\n\r\n  @Listen('moveBookingTo', { target: 'window' })\r\n  async moveBookingToHandler(event: CustomEvent) {\r\n    try {\r\n      if (event.detail.bookingId !== this.getBookingId()) {\r\n        this.showEventInfo(false);\r\n        return;\r\n      }\r\n\r\n      if (event.detail.moveToDay === 'revert' || event.detail.toRoomId === 'revert') {\r\n        event.detail.moveToDay = this.bookingEvent.FROM_DATE;\r\n        event.detail.toRoomId = event.detail.fromRoomId;\r\n        if (this.isTouchStart && this.moveDiffereneX <= 5 && this.moveDiffereneY <= 5 && !this.isStreatch) {\r\n          if (isBlockUnit(this.bookingEvent.STATUS_CODE)) {\r\n            this.showEventInfo(true);\r\n          } else if (['IN-HOUSE', 'CONFIRMED', 'PENDING-CONFIRMATION', 'CHECKED-OUT'].includes(this.bookingEvent.STATUS)) {\r\n            await this.fetchAndAssignBookingData();\r\n          }\r\n        } else {\r\n          this.animationFrameId = requestAnimationFrame(() => {\r\n            this.resetBookingToInitialPosition();\r\n          });\r\n          return;\r\n        }\r\n      } else {\r\n        if (this.isTouchStart && this.moveDiffereneX <= 5 && this.moveDiffereneY <= 5 && !this.isStreatch) {\r\n          if (isBlockUnit(this.bookingEvent.STATUS_CODE)) {\r\n            this.showEventInfo(true);\r\n          } else if (['IN-HOUSE', 'CONFIRMED', 'PENDING-CONFIRMATION', 'CHECKED-OUT'].includes(this.bookingEvent.STATUS)) {\r\n            await this.fetchAndAssignBookingData();\r\n          }\r\n        } else {\r\n          const { pool, to_date, from_date, toRoomId } = event.detail as any;\r\n          if (this.checkIfSlotOccupied(toRoomId, from_date, to_date)) {\r\n            this.animationFrameId = requestAnimationFrame(() => {\r\n              this.resetBookingToInitialPosition();\r\n            });\r\n            throw new Error('Overlapping Dates');\r\n          }\r\n          if (pool) {\r\n            if (isBlockUnit(this.bookingEvent.STATUS_CODE)) {\r\n              await this.eventsService.reallocateEvent(pool, toRoomId, from_date, to_date).catch(() => {\r\n                this.resetBookingToInitialPosition();\r\n              });\r\n            } else {\r\n              if (this.isShrinking || !this.isStreatch) {\r\n                console.log(this.bookingEvent.PR_ID.toString() === toRoomId.toString(), this.bookingEvent.PR_ID.toString(), toRoomId.toString());\r\n                try {\r\n                  if (this.bookingEvent.PR_ID.toString() === toRoomId.toString()) {\r\n                    await this.eventsService.reallocateEvent(pool, toRoomId, from_date, to_date);\r\n                    return;\r\n                  }\r\n                } catch (error) {\r\n                  this.resetBookingToInitialPosition();\r\n                  return;\r\n                }\r\n                const { description, status } = this.setModalDescription(toRoomId, from_date, to_date);\r\n                let hideConfirmButton = false;\r\n                if (status === '400') {\r\n                  hideConfirmButton = true;\r\n                }\r\n                this.showDialog.emit({ ...event.detail, description, title: '', hideConfirmButton });\r\n              } else {\r\n                // if (this.checkIfSlotOccupied(toRoomId, from_date, to_date)) {\r\n                //   this.animationFrameId = requestAnimationFrame(() => {\r\n                //     this.resetBookingToInitialPosition();\r\n                //   });\r\n                //   throw new Error('Overlapping Dates');\r\n                // } else {\r\n                this.showRoomNightsDialog.emit({ bookingNumber: this.bookingEvent.BOOKING_NUMBER, identifier: this.bookingEvent.IDENTIFIER, to_date, pool, from_date });\r\n                // }\r\n              }\r\n            }\r\n            this.isShrinking = null;\r\n          }\r\n        }\r\n      }\r\n    } catch (error) {\r\n      this.toast.emit({\r\n        position: 'top-right',\r\n        title: error.message,\r\n        description: '',\r\n        type: 'error',\r\n      });\r\n      console.log('something went wrong');\r\n    }\r\n  }\r\n  private setModalDescription(toRoomId: number, from_date, to_date): { status: '200' | '400'; description: string } {\r\n    const findRoomType = (roomId: number) => {\r\n      let roomType = this.bookingEvent.roomsInfo.filter(room => room.physicalrooms.some(r => r.id === +roomId));\r\n      if (roomType.length) {\r\n        return roomType[0].id;\r\n      }\r\n      return null;\r\n    };\r\n    if (!this.bookingEvent.is_direct) {\r\n      if (this.isShrinking) {\r\n        return {\r\n          description: `${locales.entries.Lcz_YouWillLoseFutureUpdates}.`,\r\n          status: '200',\r\n        };\r\n      } else {\r\n        if (\r\n          moment(from_date, 'YYYY-MM-DD').isSame(moment(this.bookingEvent.FROM_DATE, 'YYYY-MM-DD')) &&\r\n          moment(to_date, 'YYYY-MM-DD').isSame(moment(this.bookingEvent.TO_DATE, 'YYYY-MM-DD'))\r\n        ) {\r\n          const initialRT = findRoomType(this.bookingEvent.PR_ID);\r\n          const targetRT = findRoomType(toRoomId);\r\n          if (initialRT === targetRT) {\r\n            return { description: `${locales.entries.Lcz_AreYouSureWantToMoveAnotherUnit}?`, status: '200' };\r\n          } else {\r\n            return {\r\n              description: `${locales.entries.Lcz_YouWillLoseFutureUpdates} ${this.bookingEvent.origin ? this.bookingEvent.origin.Label : ''}. ${\r\n                locales.entries.Lcz_SameRatesWillBeKept\r\n              }`,\r\n              status: '200',\r\n            };\r\n          }\r\n        }\r\n        return { description: locales.entries.Lcz_CannotChangeCHBookings, status: '400' };\r\n      }\r\n    } else {\r\n      if (!this.isShrinking) {\r\n        const initialRT = findRoomType(this.bookingEvent.PR_ID);\r\n        const targetRT = findRoomType(toRoomId);\r\n        if (initialRT === targetRT) {\r\n          console.log('same rt');\r\n          return { description: `${locales.entries.Lcz_AreYouSureWantToMoveAnotherUnit}?`, status: '200' };\r\n        } else {\r\n          return {\r\n            description: locales.entries.Lcz_SameRatesWillBeKept,\r\n            status: '200',\r\n          };\r\n        }\r\n      }\r\n      return { description: locales.entries.Lcz_BalanceWillBeCalculated, status: '200' };\r\n    }\r\n  }\r\n  private resetBookingToInitialPosition() {\r\n    if (this.isStreatch) {\r\n      this.element.style.left = `${this.initialLeft}px`;\r\n      this.element.style.width = `${this.initialWidth}px`;\r\n      this.isStreatch = false;\r\n      this.finalWidth = this.initialWidth;\r\n      this.isShrinking = null;\r\n    } else {\r\n      this.element.style.top = `${this.dragInitPos.top}px`;\r\n      this.element.style.left = `${this.dragInitPos.left}px`;\r\n    }\r\n  }\r\n  @Listen('revertBooking', { target: 'window' })\r\n  handleRevertBooking(event: CustomEvent<string>) {\r\n    if (this.bookingEvent.POOL === event.detail) {\r\n      this.resetBookingToInitialPosition();\r\n    }\r\n  }\r\n  checkIfSlotOccupied(toRoomId, from_date, to_date) {\r\n    const fromTime = moment(from_date, 'YYYY-MM-DD');\r\n    const toTime = moment(to_date, 'YYYY-MM-DD');\r\n    const isOccupied = this.allBookingEvents.some(event => {\r\n      if (event.POOL === this.bookingEvent.POOL) {\r\n        return false;\r\n      }\r\n      const eventFromTime = moment(event.FROM_DATE, 'YYYY-MM-DD').add(1, 'days');\r\n      const eventToTime = moment(event.TO_DATE, 'YYYY-MM-DD');\r\n      return event.PR_ID === +toRoomId && toTime.isSameOrAfter(eventFromTime) && fromTime.isBefore(eventToTime);\r\n    });\r\n    return isOccupied;\r\n  }\r\n\r\n  renderAgain() {\r\n    this.renderElement = !this.renderElement;\r\n  }\r\n\r\n  getUniqueId() {\r\n    return new Date().getTime();\r\n  }\r\n\r\n  isSplitBooking() {\r\n    return !!this.bookingEvent.SPLIT_BOOKING;\r\n  }\r\n\r\n  isNewEvent() {\r\n    return this.getBookingId() === 'NEW_TEMP_EVENT';\r\n  }\r\n\r\n  isHighlightEventType() {\r\n    return this.getEventType() === 'HIGH_LIGHT';\r\n  }\r\n\r\n  getBookingId() {\r\n    return this.bookingEvent.ID;\r\n  }\r\n\r\n  getBookingStatus() {\r\n    return this.bookingEvent.STATUS;\r\n  }\r\n\r\n  getBookedBy() {\r\n    return this.bookingEvent.NAME;\r\n  }\r\n\r\n  getBookedRoomId() {\r\n    return this.bookingEvent.PR_ID;\r\n  }\r\n\r\n  getEventStartingDate() {\r\n    return new Date(this.bookingEvent.FROM_DATE);\r\n  }\r\n\r\n  getEventEndingDate() {\r\n    return new Date(this.bookingEvent.TO_DATE);\r\n  }\r\n\r\n  getEventType() {\r\n    return this.bookingEvent.event_type;\r\n  }\r\n\r\n  getEventLegend() {\r\n    // console.log(this.getBookingStatus());\r\n    let status = this.bookingEvent?.legendData.statusId[this.getBookingStatus()];\r\n    let orderRide = this.isNewEvent() ? { color: '#f9f9c9' } : {};\r\n    return {\r\n      ...this.bookingEvent?.legendData[status.id],\r\n      ...status,\r\n      ...orderRide,\r\n    };\r\n  }\r\n\r\n  getLegendOfStatus(aStatusId) {\r\n    // console.log(aStatusId);\r\n    let status = this.bookingEvent?.legendData.statusId[aStatusId];\r\n    return { ...this.bookingEvent.legendData[status.id], ...status };\r\n  }\r\n\r\n  getNoteNode() {\r\n    if (this.bookingEvent.NOTES || this.bookingEvent.INTERNAL_NOTE) {\r\n      return this.getLegendOfStatus('NOTES');\r\n    }\r\n    return null;\r\n  }\r\n\r\n  getBalanceNode() {\r\n    if (this.bookingEvent.BALANCE !== null && this.bookingEvent.BALANCE > 0) {\r\n      return this.getLegendOfStatus('OUTSTANDING-BALANCE');\r\n    }\r\n    return null;\r\n  }\r\n\r\n  setStayDays(aStayDays: number) {\r\n    this.bookingEvent.NO_OF_DAYS = aStayDays;\r\n    this.renderAgain();\r\n    // this.updateData({id: this.getBookedRoomId(), data: { NO_OF_DAYS: aStayDays }});\r\n  }\r\n\r\n  getStayDays() {\r\n    return this.bookingEvent.NO_OF_DAYS;\r\n  }\r\n\r\n  getPosition() {\r\n    let startingDate = this.getEventStartingDate();\r\n    let startingCellClass = '.room_' + this.getBookedRoomId() + '_' + startingDate.getDate() + '_' + (startingDate.getMonth() + 1) + '_' + startingDate.getFullYear();\r\n    let bodyContainer = document.querySelector('.bodyContainer');\r\n    let startingCell = document.querySelector(startingCellClass);\r\n    let pos = { top: '0', left: '0', width: '0', height: '20px' };\r\n    if (startingCell && bodyContainer && startingCell.getBoundingClientRect() && bodyContainer.getBoundingClientRect()) {\r\n      let bodyContainerRect = bodyContainer.getBoundingClientRect();\r\n      let boundingRect = startingCell.getBoundingClientRect();\r\n      this.dayWidth = this.dayWidth || boundingRect.width;\r\n      pos.top = boundingRect.top + boundingRect.height / 2 - this.vertSpace - bodyContainerRect.top + 'px';\r\n      pos.left = boundingRect.left + this.dayWidth / 2 + this.eventSpace / 2 - bodyContainerRect.left + 'px';\r\n      pos.width = this.getStayDays() * this.dayWidth - this.eventSpace + 'px';\r\n    } else {\r\n      console.log('Locating event cell failed ', startingCellClass);\r\n    }\r\n    //console.log(pos);\r\n    return pos;\r\n  }\r\n\r\n  getNumber(aData) {\r\n    return aData ? parseFloat(aData) : 0;\r\n  }\r\n\r\n  startDragging(event: any, side: string) {\r\n    event.preventDefault();\r\n    event.stopPropagation();\r\n    event.stopImmediatePropagation();\r\n\r\n    if (this.isNewEvent() || this.isHighlightEventType()) {\r\n      return null;\r\n    }\r\n\r\n    this.resizeSide = side;\r\n    this.isDragging = true;\r\n\r\n    this.showEventInfo(false); // Hide bubble;\r\n    this.isStreatch = side !== 'move';\r\n    if (side === 'move') {\r\n      this.initialX = event.clientX || event.touches[0].clientX;\r\n      this.initialY = event.clientY || event.touches[0].clientY;\r\n      this.elementRect = this.element.getBoundingClientRect();\r\n      const offsetX = 0; //this.initialX - this.elementRect.left - 18;\r\n      const offsetY = 0; // this.initialY - this.elementRect.top - (this.elementRect.height/2);\r\n      this.dragInitPos = {\r\n        id: this.getBookingId(),\r\n        fromRoomId: this.getBookedRoomId(),\r\n        top: this.getNumber(this.element.style.top) + offsetY,\r\n        left: this.getNumber(this.element.style.left) + offsetX,\r\n      };\r\n      this.dragInitPos.x = this.dragInitPos.left; // + 18;\r\n      this.dragInitPos.y = this.dragInitPos.top; // + (this.elementRect.height/2);\r\n      this.dragEndPos = { ...this.dragInitPos };\r\n      this.element.style.top = `${this.dragInitPos.top}px`;\r\n      this.element.style.left = `${this.dragInitPos.left}px`;\r\n      this.isTouchStart = true; // !!(event.touches && event.touches.length);\r\n      this.dragOverEventData.emit({\r\n        id: 'CALCULATE_DRAG_OVER_BOUNDS',\r\n        data: this.dragInitPos,\r\n      });\r\n    } else {\r\n      this.initialWidth = this.element.offsetWidth;\r\n      this.initialLeft = this.element.offsetLeft;\r\n      this.initialX = event.clientX || event.touches[0].clientX;\r\n      this.dragOverEventData.emit({\r\n        id: 'CALCULATE_DRAG_OVER_BOUNDS',\r\n        data: {\r\n          id: this.getBookingId(),\r\n          fromRoomId: this.getBookedRoomId(),\r\n          top: this.getNumber(this.element.style.top),\r\n          left: this.initialLeft,\r\n          x: this.initialX,\r\n          y: event.clientY || event.touches[0].clientY,\r\n        },\r\n      });\r\n    }\r\n\r\n    document.addEventListener('mousemove', this.handleMouseMoveBind);\r\n    document.addEventListener('touchmove', this.handleMouseMoveBind);\r\n    document.addEventListener('pointermove', this.handleMouseMoveBind);\r\n\r\n    document.addEventListener('mouseup', this.handleMouseUpBind);\r\n    document.addEventListener('touchup', this.handleMouseUpBind);\r\n    document.addEventListener('pointerup', this.handleMouseUpBind);\r\n  }\r\n\r\n  handleMouseMove(event: any) {\r\n    if (this.isDragging) {\r\n      this.currentX = event.clientX || event.touches[0].clientX;\r\n      let distanceX = this.currentX - this.initialX;\r\n      if (this.resizeSide === 'move') {\r\n        this.currentY = event.clientY || event.touches[0].clientY;\r\n        let distanceY = this.currentY - this.initialY;\r\n        this.element.style.top = `${this.dragInitPos.top + distanceY}px`;\r\n        this.element.style.left = `${this.dragInitPos.left + distanceX}px`;\r\n        this.dragEndPos = {\r\n          id: this.getBookingId(),\r\n          fromRoomId: this.getBookedRoomId(),\r\n          top: this.dragInitPos.top + distanceY,\r\n          left: this.dragInitPos.left + distanceX,\r\n        };\r\n        this.dragEndPos.x = this.dragEndPos.left; // + 18;\r\n        this.dragEndPos.y = this.dragEndPos.top; // + (this.elementRect.height/2);\r\n        this.dragOverEventData.emit({ id: 'DRAG_OVER', data: this.dragEndPos });\r\n      } else {\r\n        if (!this.bookingEvent.is_direct && !isBlockUnit(this.bookingEvent.STATUS_CODE)) {\r\n          return;\r\n        }\r\n        let newWidth = this.initialWidth;\r\n        if (this.resizeSide == 'rightSide') {\r\n          newWidth = this.initialWidth + distanceX;\r\n          newWidth = Math.min(newWidth, this.initialX + this.element.offsetWidth);\r\n          newWidth = Math.max(this.dayWidth - this.eventSpace, newWidth);\r\n          this.element.style.width = `${newWidth}px`;\r\n          this.isShrinking = distanceX < 0;\r\n        } else if (this.resizeSide == 'leftSide') {\r\n          this.isShrinking = distanceX > 0;\r\n          newWidth = Math.max(this.dayWidth - this.eventSpace, this.initialWidth - distanceX);\r\n          let newLeft = this.initialLeft + (this.initialWidth - newWidth);\r\n          this.element.style.left = `${newLeft}px`;\r\n          this.element.style.width = `${newWidth}px`;\r\n        }\r\n        this.finalWidth = newWidth;\r\n      }\r\n    } else {\r\n      console.log('still mouse move listening...');\r\n    }\r\n  }\r\n\r\n  handleMouseUp() {\r\n    if (this.isDragging) {\r\n      if (this.resizeSide === 'move') {\r\n        // console.log(\"Initial X::\"+this.dragInitPos.x);\r\n        // console.log(\"Initial Y::\"+this.dragInitPos.y);\r\n        // console.log(\"End X::\"+this.dragEndPos.x);\r\n        // console.log(\"End Y::\"+this.dragEndPos.y);\r\n        if (this.isTouchStart) {\r\n          this.moveDiffereneX = Math.abs(this.dragEndPos.x - this.dragInitPos.x);\r\n          this.moveDiffereneY = Math.abs(this.dragEndPos.y - this.dragInitPos.y);\r\n        }\r\n        this.dragOverEventData.emit({\r\n          id: 'DRAG_OVER_END',\r\n          data: {\r\n            ...this.dragEndPos,\r\n            pool: this.bookingEvent.POOL,\r\n            nbOfDays: this.bookingEvent.NO_OF_DAYS,\r\n          },\r\n        });\r\n      } else {\r\n        let numberOfDays = Math.round(this.finalWidth / this.dayWidth);\r\n        let initialStayDays = this.getStayDays();\r\n        if (initialStayDays != numberOfDays && !isNaN(numberOfDays)) {\r\n          //this.setStayDays(numberOfDays);\r\n          if (this.resizeSide == 'leftSide') {\r\n            this.element.style.left = `${this.initialLeft + (initialStayDays - numberOfDays) * this.dayWidth}px`;\r\n            // set FROM_DATE = TO_DATE - numberOfDays\r\n          } else {\r\n            if (numberOfDays < initialStayDays) {\r\n              this.isShrinking = true;\r\n            }\r\n            // set TO_DATE = FROM_DATE + numberOfDays\r\n          }\r\n          this.dragOverEventData.emit({\r\n            id: 'STRETCH_OVER_END',\r\n            data: {\r\n              id: this.getBookingId(),\r\n              fromRoomId: +this.getBookedRoomId(),\r\n              x: +this.element.style.left.replace('px', ''),\r\n              y: +this.element.style.top.replace('px', ''),\r\n              pool: this.bookingEvent.POOL,\r\n              nbOfDays: numberOfDays,\r\n            },\r\n          });\r\n\r\n          this.element.style.width = `${numberOfDays * this.dayWidth - this.eventSpace}px`;\r\n        } else {\r\n          this.element.style.left = `${this.initialLeft}px`;\r\n          this.element.style.width = `${numberOfDays * this.dayWidth - this.eventSpace}px`;\r\n        }\r\n      }\r\n    } else {\r\n      console.log('still mouse up listening...');\r\n    }\r\n    this.isDragging = false;\r\n\r\n    document.removeEventListener('mousemove', this.handleMouseMoveBind);\r\n    document.removeEventListener('touchmove', this.handleMouseMoveBind);\r\n    document.removeEventListener('pointermove', this.handleMouseMoveBind);\r\n\r\n    document.removeEventListener('mouseup', this.handleMouseUpBind);\r\n    document.removeEventListener('touchup', this.handleMouseUpBind);\r\n    document.removeEventListener('pointerup', this.handleMouseUpBind);\r\n  }\r\n\r\n  updateData(data: any) {\r\n    this.updateEventData.emit(data);\r\n  }\r\n  renderEventBookingNumber() {\r\n    if (this.bookingEvent.STATUS === 'TEMP-EVENT' || this.bookingEvent.ID === 'NEW_TEMP_EVENT') {\r\n      return '';\r\n    }\r\n    if (isBlockUnit(this.bookingEvent.STATUS_CODE)) {\r\n      return '';\r\n    }\r\n    if (!this.bookingEvent.is_direct) {\r\n      return ` - ${this.bookingEvent.channel_booking_nbr}`;\r\n    }\r\n    return ` - ${this.bookingEvent.BOOKING_NUMBER}`;\r\n  }\r\n  showEventInfo(showInfo) {\r\n    if (this.isHighlightEventType() || this.bookingEvent.hideBubble) {\r\n      return null;\r\n    }\r\n\r\n    if (showInfo) {\r\n      // Calculate which side we need to show the bubble, top side or bottom.\r\n      let bodyContainer = document.querySelector('.calendarScrollContainer');\r\n      let bodyContainerRect: { [key: string]: any } = bodyContainer.getBoundingClientRect();\r\n      let elementRect: { [key: string]: any } = this.element.getBoundingClientRect();\r\n      let midPoint = bodyContainerRect.height / 2 + bodyContainerRect.top + 50;\r\n      // let topDifference = elementRect.top - bodyContainerRect.top;\r\n      // let bottomDifference = bodyContainerRect.bottom - elementRect.bottom;\r\n\r\n      if (elementRect.top < midPoint) {\r\n        this.bubbleInfoTopSide = false;\r\n      } else {\r\n        this.bubbleInfoTopSide = true;\r\n      }\r\n    }\r\n\r\n    // showInfo = true;\r\n    if (showInfo) {\r\n      this.hideBubbleInfo.emit({\r\n        key: 'hidePopup',\r\n        currentInfoBubbleId: this.getBookingId(),\r\n      });\r\n    }\r\n    this.showInfoPopup = showInfo;\r\n    this.renderAgain();\r\n  }\r\n\r\n  render() {\r\n    // onMouseLeave={()=>this.showEventInfo(false)}\r\n    let legend = this.getEventLegend();\r\n    let noteNode = this.getNoteNode();\r\n    let balanceNode = this.getBalanceNode();\r\n\r\n    return (\r\n      <Host\r\n        class={`bookingEvent  ${this.isNewEvent() || this.isHighlightEventType() ? 'newEvent' : ''} ${legend.clsName} `}\r\n        style={this.getPosition()}\r\n        id={'event_' + this.getBookingId()}\r\n      >\r\n        {/* onMouseOver={() =>this.showEventInfo(true)}  */}\r\n        <div\r\n          class={`bookingEventBase  ${\r\n            !this.bookingEvent.is_direct &&\r\n            !isBlockUnit(this.bookingEvent.STATUS_CODE) &&\r\n            this.bookingEvent.STATUS !== 'TEMP-EVENT' &&\r\n            this.bookingEvent.ID !== 'NEW_TEMP_EVENT' &&\r\n            'border border-dark'\r\n          }  ${this.isSplitBooking() ? 'splitBooking' : ''}`}\r\n          style={{ backgroundColor: legend.color }}\r\n          onTouchStart={event => this.startDragging(event, 'move')}\r\n          onMouseDown={event => this.startDragging(event, 'move')}\r\n        ></div>\r\n        {noteNode ? <div class=\"legend_circle noteIcon\" style={{ backgroundColor: noteNode.color }}></div> : null}\r\n        {balanceNode ? <div class=\"legend_circle balanceIcon\" style={{ backgroundColor: balanceNode.color }}></div> : null}\r\n        {/* onMouseOver={() => this.showEventInfo(true)}  */}\r\n        <div class=\"bookingEventTitle\" onTouchStart={event => this.startDragging(event, 'move')} onMouseDown={event => this.startDragging(event, 'move')}>\r\n          {this.getBookedBy()}\r\n          {this.renderEventBookingNumber()}\r\n        </div>\r\n\r\n        <Fragment>\r\n          <div\r\n            class=\"bookingEventDragHandle leftSide\"\r\n            onTouchStart={event => this.startDragging(event, 'leftSide')}\r\n            onMouseDown={event => this.startDragging(event, 'leftSide')}\r\n          ></div>\r\n          <div\r\n            class=\"bookingEventDragHandle rightSide\"\r\n            onTouchStart={event => this.startDragging(event, 'rightSide')}\r\n            onMouseDown={event => this.startDragging(event, 'rightSide')}\r\n          ></div>\r\n        </Fragment>\r\n\r\n        {this.showInfoPopup ? (\r\n          <igl-booking-event-hover\r\n            is_vacation_rental={this.is_vacation_rental}\r\n            countryNodeList={this.countryNodeList}\r\n            currency={this.currency}\r\n            class=\"top\"\r\n            bookingEvent={this.bookingEvent}\r\n            bubbleInfoTop={this.bubbleInfoTopSide}\r\n          ></igl-booking-event-hover>\r\n        ) : null}\r\n      </Host>\r\n    );\r\n  }\r\n}\r\n",":host {\r\n  display: block;\r\n  position: relative;\r\n  z-index: 100;\r\n}\r\n\r\n.btn {\r\n  padding-left: 4px !important;\r\n  padding-right: 4px !important;\r\n}\r\n.user-notes {\r\n  margin-left: 4px;\r\n  display: -webkit-box;\r\n  -webkit-box-orient: vertical;\r\n  -webkit-line-clamp: 5;\r\n  overflow: hidden;\r\n  max-width: 100%;\r\n  height: auto;\r\n}\r\n.mx-01 {\r\n  --m: 5px;\r\n  margin-left: var(--m) !important;\r\n  margin-right: var(--m) !important;\r\n}\r\n.pointerContainer {\r\n  position: absolute;\r\n  left: 50%;\r\n  height: 10px;\r\n  width: 350px;\r\n  transform: translate(-50%, 0);\r\n}\r\n\r\n.pointerContainerTop {\r\n  top: -26px;\r\n}\r\n\r\n.iglPopOver {\r\n  /* max-width: 350px; */\r\n  background-color: #fff;\r\n  padding: 10px;\r\n  border: 1px solid #656ee7;\r\n  border-radius: 6px;\r\n  position: absolute;\r\n  transform: translate(-50%, 10px);\r\n  left: 50%;\r\n  box-shadow: 1px 0px 20px rgba(0, 0, 0, 0.2);\r\n}\r\n\r\n.iglPopOver.infoBubble {\r\n  width: 350px;\r\n}\r\n\r\n.iglPopOver.blockedView {\r\n  max-width: 400px;\r\n  width: 400px;\r\n}\r\n\r\n.iglPopOver.newBookingOptions {\r\n  overflow-wrap: break-word !important;\r\n  min-width: 230px;\r\n  width: fit-content;\r\n}\r\n\r\n.bubblePointer {\r\n  position: absolute;\r\n  width: 0;\r\n  height: 0;\r\n  left: 50%;\r\n  border-left: 10px solid transparent;\r\n  border-right: 10px solid transparent;\r\n  transform: translate(-50%, 0px);\r\n}\r\n\r\n.bubblePointTop {\r\n  border-top: 10px solid #656ee7;\r\n}\r\n\r\n.bubblePointBottom {\r\n  border-bottom: 10px solid #656ee7;\r\n}\r\n\r\n.bubbleInfoAbove {\r\n  bottom: 35px;\r\n}\r\n\r\n.updateBtnIcon {\r\n  margin-right: 4px;\r\n}\r\n.icon-image {\r\n  margin-right: 5px;\r\n}\r\n","import { Component, Host, h, Prop, Event, EventEmitter, State, Element, Fragment } from '@stencil/core';\r\nimport { findCountry, getCurrencySymbol } from '../../../utils/utils';\r\nimport { ICountry } from '../../../models/IBooking';\r\nimport { EventsService } from '../../../services/events.service';\r\nimport moment from 'moment';\r\nimport locales from '@/stores/locales.store';\r\nimport calendar_data from '@/stores/calendar-data';\r\n//import { transformNewBLockedRooms } from '../../../utils/booking';\r\n\r\n@Component({\r\n  tag: 'igl-booking-event-hover',\r\n  styleUrl: 'igl-booking-event-hover.css',\r\n  scoped: true,\r\n})\r\nexport class IglBookingEventHover {\r\n  @Prop({ mutable: true }) bookingEvent: { [key: string]: any };\r\n  @Prop() bubbleInfoTop: boolean = false;\r\n  @Prop() currency;\r\n  @Prop() countryNodeList: ICountry[];\r\n  @Prop() is_vacation_rental: boolean = false;\r\n  @State() isLoading: string;\r\n\r\n  @Event() showBookingPopup: EventEmitter;\r\n  @Event({ bubbles: true, composed: true }) hideBubbleInfo: EventEmitter;\r\n  @Event({ bubbles: true, composed: true }) deleteButton: EventEmitter<string>;\r\n  @Event() bookingCreated: EventEmitter<{ pool?: string; data: any[] }>;\r\n  @Element() element;\r\n  private fromTimeStamp: number;\r\n  private toTimeStamp: number;\r\n  private todayTimeStamp: number = new Date().setHours(0, 0, 0, 0);\r\n  private eventService = new EventsService();\r\n  private hideButtons = false;\r\n  @State() shouldHideUnassignUnit = false;\r\n  componentWillLoad() {\r\n    console.log('this.bookingEvent', this.bookingEvent);\r\n    this.eventService.setToken(calendar_data.token);\r\n    let selectedRt = this.bookingEvent.roomsInfo.find(r => r.id === this.bookingEvent.RATE_TYPE);\r\n    if (selectedRt) {\r\n      console.log(selectedRt.physicalrooms.length === 1);\r\n      this.shouldHideUnassignUnit = selectedRt.physicalrooms.length === 1;\r\n    }\r\n    if (moment(this.bookingEvent.TO_DATE, 'YYYY-MM-DD').isBefore(moment())) {\r\n      this.hideButtons = true;\r\n    }\r\n    this.handleKeyDown = this.handleKeyDown.bind(this);\r\n  }\r\n\r\n  handleKeyDown(event: KeyboardEvent) {\r\n    if (event.key === 'Escape') {\r\n      this.hideBubble();\r\n    } else return;\r\n  }\r\n\r\n  hideBubble() {\r\n    this.hideBubbleInfo.emit({\r\n      key: 'hidebubble',\r\n      currentInfoBubbleId: this.getBookingId(),\r\n    });\r\n    document.removeEventListener('keydown', this.handleKeyDown);\r\n  }\r\n  componentDidLoad() {\r\n    document.addEventListener('keydown', this.handleKeyDown);\r\n  }\r\n  disconnectedCallback() {\r\n    document.removeEventListener('keydown', this.handleKeyDown);\r\n  }\r\n  getBookingId() {\r\n    return this.bookingEvent.ID;\r\n  }\r\n\r\n  getTotalOccupants() {\r\n    return this.bookingEvent.ADULTS_COUNT;\r\n  }\r\n\r\n  getPhoneNumber() {\r\n    return this.bookingEvent.PHONE;\r\n  }\r\n\r\n  getCountry() {\r\n    return findCountry(this.bookingEvent.COUNTRY, this.countryNodeList).name;\r\n  }\r\n  getPhoneCode() {\r\n    return findCountry(this.bookingEvent.COUNTRY, this.countryNodeList).phone_prefix;\r\n  }\r\n  renderPhone() {\r\n    return this.bookingEvent.COUNTRY ? `${this.bookingEvent.is_direct ? this.getPhoneCode() + '-' : ''}${this.getPhoneNumber()} - ${this.getCountry()}` : this.getPhoneNumber();\r\n  }\r\n\r\n  getGuestNote() {\r\n    return this.bookingEvent.NOTES && <p class={'user-notes p-0 my-0'}>{this.bookingEvent.NOTES}</p>;\r\n  }\r\n\r\n  getInternalNote() {\r\n    return this.bookingEvent.INTERNAL_NOTE;\r\n  }\r\n\r\n  getTotalPrice() {\r\n    return this.bookingEvent.TOTAL_PRICE;\r\n  }\r\n\r\n  getCheckInDate() {\r\n    return this.bookingEvent.FROM_DATE_STR;\r\n  }\r\n\r\n  getCheckOutDate() {\r\n    return this.bookingEvent.TO_DATE_STR;\r\n  }\r\n\r\n  getArrivalTime() {\r\n    return this.bookingEvent.ARRIVAL_TIME;\r\n  }\r\n\r\n  getRatePlan() {\r\n    return this.bookingEvent.RATE_PLAN;\r\n  }\r\n\r\n  getEntryDate() {\r\n    return this.bookingEvent.ENTRY_DATE;\r\n  }\r\n\r\n  getReleaseAfterHours() {\r\n    return this.bookingEvent.RELEASE_AFTER_HOURS;\r\n  }\r\n\r\n  isNewBooking() {\r\n    return this.getBookingId() === 'NEW_TEMP_EVENT';\r\n  }\r\n\r\n  isCheckedIn() {\r\n    return this.bookingEvent.STATUS === 'CHECKED-IN';\r\n  }\r\n\r\n  isCheckedOut() {\r\n    return this.bookingEvent.STATUS === 'CHECKED-OUT';\r\n  }\r\n\r\n  isBlockedDateEvent() {\r\n    return this.bookingEvent.STATUS === 'BLOCKED' || this.bookingEvent.STATUS === 'BLOCKED-WITH-DATES';\r\n  }\r\n\r\n  getRoomId() {\r\n    return this.bookingEvent.PR_ID;\r\n  }\r\n\r\n  getCategoryByRoomId(roomId) {\r\n    // console.log(\"room id \",roomId)\r\n    // console.log(\"booking event\",this.bookingEvent)\r\n    return this.bookingEvent.roomsInfo.find(roomCategory => roomCategory.physicalrooms.find(room => room.id === roomId));\r\n  }\r\n\r\n  hasSplitBooking() {\r\n    return this.bookingEvent.hasOwnProperty('splitBookingEvents') && this.bookingEvent.splitBookingEvents;\r\n  }\r\n\r\n  canCheckIn() {\r\n    if (!this.fromTimeStamp) {\r\n      let dt = new Date(this.getCheckInDate());\r\n      dt.setHours(0, 0, 0, 0);\r\n      this.fromTimeStamp = dt.getTime();\r\n    }\r\n    if (!this.toTimeStamp) {\r\n      let dt = new Date(this.getCheckOutDate());\r\n      dt.setHours(0, 0, 0, 0);\r\n      this.toTimeStamp = dt.getTime();\r\n    }\r\n    if (this.isCheckedIn() || this.isCheckedOut()) {\r\n      return false;\r\n    }\r\n    if (this.fromTimeStamp <= this.todayTimeStamp && this.todayTimeStamp <= this.toTimeStamp) {\r\n      return true;\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  canCheckOut() {\r\n    if (this.isCheckedIn() && this.todayTimeStamp <= this.toTimeStamp) {\r\n      return true;\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  handleBlockDateUpdate(event: CustomEvent<{ [key: string]: any }>) {\r\n    event.stopImmediatePropagation();\r\n    event.stopPropagation();\r\n    const opt: { [key: string]: any } = event.detail;\r\n    this.bookingEvent = { ...this.bookingEvent, ...opt.data };\r\n    //console.log(\"blocked date booking event\", this.bookingEvent);\r\n  }\r\n\r\n  handleEditBooking() {\r\n    // console.log(\"Edit booking\");\r\n    this.bookingEvent.TITLE = locales.entries.Lcz_EditBookingFor;\r\n    this.handleBookingOption('EDIT_BOOKING');\r\n  }\r\n\r\n  getStringDateFormat(dt) {\r\n    return dt.getFullYear() + '-' + (dt.getMonth() < 9 ? '0' : '') + (dt.getMonth() + 1) + '-' + (dt.getDate() <= 9 ? '0' : '') + dt.getDate();\r\n  }\r\n\r\n  handleAddRoom() {\r\n    let fromDate = new Date(this.bookingEvent.FROM_DATE);\r\n    fromDate.setHours(0, 0, 0, 0);\r\n    let from_date_str = this.getStringDateFormat(fromDate);\r\n\r\n    let toDate = new Date(this.bookingEvent.TO_DATE);\r\n    //toDate.setDate(toDate.getDate() + 1);\r\n    toDate.setHours(0, 0, 0, 0);\r\n    let to_date_str = this.getStringDateFormat(toDate);\r\n    //console.log(this.bookingEvent);\r\n    let eventData = {\r\n      ID: '',\r\n      NAME: '',\r\n      BOOKING_NUMBER: this.bookingEvent.BOOKING_NUMBER,\r\n      FROM_DATE: from_date_str, // \"2023-07-09\",\r\n      TO_DATE: to_date_str, // \"2023-07-11\",\r\n      roomsInfo: this.bookingEvent.roomsInfo,\r\n      ARRIVAL: this.bookingEvent.ARRIVAL,\r\n      ADD_ROOM_TO_BOOKING: this.bookingEvent.ID,\r\n      TITLE: 'Add Room to #' + this.bookingEvent.BOOKING_NUMBER,\r\n      event_type: 'ADD_ROOM',\r\n      ROOMS: this.bookingEvent.ROOMS,\r\n      GUEST: this.bookingEvent.GUEST,\r\n      message: this.bookingEvent.NOTES,\r\n      SOURCE: this.bookingEvent.SOURCE,\r\n      defaultDateRange: {\r\n        fromDate: fromDate, //new Date(\"2023-09-10\"),\r\n        fromDateStr: '', //\"10 Sep 2023\",\r\n        toDate: toDate, //new Date(\"2023-09-15\"),\r\n        toDateStr: '', // \"15 Sep 2023\",\r\n        dateDifference: 0,\r\n        editabled: true,\r\n        message: 'Including 5.00% City Tax - Excluding 11.00% VAT',\r\n      },\r\n    };\r\n\r\n    this.handleBookingOption('ADD_ROOM', eventData);\r\n  }\r\n\r\n  handleCustomerCheckIn() {\r\n    console.log('Handle Customer Check In');\r\n  }\r\n\r\n  handleCustomerCheckOut() {\r\n    console.log('Handle Customer Check Out');\r\n  }\r\n  handleDeleteEvent() {\r\n    this.hideBubble();\r\n    this.deleteButton.emit(this.bookingEvent.POOL);\r\n    console.log('Delete Event');\r\n  }\r\n\r\n  async handleUpdateBlockedDates() {\r\n    try {\r\n      this.isLoading = 'update';\r\n      setTimeout(() => {\r\n        this.hideBubble();\r\n      }, 50);\r\n      await this.eventService.updateBlockedEvent(this.bookingEvent);\r\n      this.isLoading = '';\r\n    } catch (error) {\r\n      //   toastr.error(error);\r\n    }\r\n  }\r\n\r\n  handleConvertBlockedDateToBooking() {\r\n    this.handleBookingOption('BAR_BOOKING');\r\n  }\r\n\r\n  getRoomInfo() {\r\n    const roomIdToFind = +this.bookingEvent.PR_ID;\r\n    let selectedRoom: any = {};\r\n\r\n    for (const room of this.bookingEvent.roomsInfo) {\r\n      for (const physicalRoom of room.physicalrooms) {\r\n        if (roomIdToFind === physicalRoom.id) {\r\n          selectedRoom.CATEGORY = room.name;\r\n          selectedRoom.ROOM_NAME = physicalRoom.name;\r\n          selectedRoom.ROOMS_INFO = room;\r\n          return selectedRoom;\r\n        }\r\n      }\r\n    }\r\n\r\n    return selectedRoom;\r\n  }\r\n  renderTitle(eventType, roomInfo) {\r\n    switch (eventType) {\r\n      case 'EDIT_BOOKING':\r\n        return `${locales.entries.Lcz_EditBookingFor} ${roomInfo.CATEGORY} ${roomInfo.ROOM_NAME}`;\r\n      case 'ADD_ROOM':\r\n        return `${locales.entries.Lcz_AddingUnitToBooking}# ${this.bookingEvent.BOOKING_NUMBER}`;\r\n      case 'SPLIT_BOOKING':\r\n        return locales.entries.Lcz_Adding + ` ${roomInfo.CATEGORY} ${roomInfo.ROOM_NAME}`;\r\n      default:\r\n        return `${locales.entries.Lcz_NewBookingFor} ${roomInfo.CATEGORY} ${roomInfo.ROOM_NAME}`;\r\n    }\r\n  }\r\n  handleBookingOption(eventType, roomData = null) {\r\n    const roomInfo = this.getRoomInfo();\r\n    let data = roomData ? roomData : this.bookingEvent;\r\n    data.event_type = eventType;\r\n    data.TITLE = this.renderTitle(eventType, roomInfo);\r\n\r\n    if (['003', '002', '004'].includes(this.bookingEvent.STATUS_CODE)) {\r\n      data.roomsInfo = [roomInfo.ROOMS_INFO];\r\n    }\r\n    this.showBookingPopup.emit({\r\n      key: 'add',\r\n      data: {\r\n        ...data,\r\n        //roomsInfo: [roomInfo.ROOMS_INFO],\r\n      },\r\n    });\r\n    this.hideBubbleInfo.emit({\r\n      key: 'hidebubble',\r\n      currentInfoBubbleId: this.getBookingId(),\r\n    });\r\n  }\r\n  renderNote() {\r\n    const { is_direct, ota_notes } = this.bookingEvent;\r\n    const guestNote = this.getGuestNote();\r\n    const noteLabel = locales.entries.Lcz_Note + ':';\r\n\r\n    if (!is_direct && ota_notes) {\r\n      return (\r\n        <div class=\"row p-0 m-0\">\r\n          <div class=\"col-12 px-0 text-wrap d-flex\">\r\n            <ota-label label={noteLabel} remarks={ota_notes}></ota-label>\r\n          </div>\r\n        </div>\r\n      );\r\n    } else if (is_direct && guestNote) {\r\n      return (\r\n        <div class=\"row p-0 m-0\">\r\n          <div class=\"col-12 px-0 text-wrap d-flex\">\r\n            <Fragment>\r\n              <span class=\"font-weight-bold\">{noteLabel} </span>\r\n              {guestNote}\r\n            </Fragment>\r\n          </div>\r\n        </div>\r\n      );\r\n    }\r\n    return null;\r\n  }\r\n\r\n  getInfoElement() {\r\n    return (\r\n      <div class={`iglPopOver infoBubble ${this.bubbleInfoTop ? 'bubbleInfoAbove' : ''} text-left`}>\r\n        <div class=\"row p-0 m-0 pb-1\">\r\n          <div class=\"px-0 col-8 font-weight-bold font-medium-1 d-flex align-items-center\">\r\n            <img src={this.bookingEvent?.origin?.Icon} alt=\"icon\" class={'icon-image'} />\r\n            <p class={'p-0 m-0'}>{!this.bookingEvent.is_direct ? this.bookingEvent.channel_booking_nbr : this.bookingEvent.BOOKING_NUMBER}</p>\r\n          </div>\r\n          <div class=\"pr-0 col-4 text-right\">\r\n            {getCurrencySymbol(this.currency.code)}\r\n            {this.getTotalPrice()}\r\n          </div>\r\n        </div>\r\n        <div class=\"row p-0 m-0\">\r\n          <div class=\"px-0 pr-0 col-12\">\r\n            <ir-date-view from_date={this.bookingEvent.FROM_DATE} to_date={this.bookingEvent.TO_DATE} showDateDifference={false}></ir-date-view>\r\n            {/* <span class=\"font-weight-bold\">{locales.entries.Lcz_In}: </span> */}\r\n          </div>\r\n        </div>\r\n        {this.getArrivalTime() && (\r\n          <div class=\"row p-0 m-0\">\r\n            <div class=\"px-0 col-12\">\r\n              <span class=\"font-weight-bold\">{locales.entries.Lcz_ArrivalTime}: </span>\r\n              {this.getArrivalTime()}\r\n            </div>\r\n          </div>\r\n        )}\r\n        {this.getTotalOccupants() && (\r\n          <div class=\"row p-0 m-0\">\r\n            <div class=\"px-0  col-12\">\r\n              <span class=\"font-weight-bold\">{locales.entries.Lcz_Occupancy}: </span>\r\n              {this.getTotalOccupants()}\r\n            </div>\r\n          </div>\r\n        )}\r\n        {this.getPhoneNumber() && (\r\n          <div class=\"row p-0 m-0\">\r\n            <div class=\"px-0  col-12 text-wrap\">\r\n              <span class=\"font-weight-bold\">{locales.entries.Lcz_Phone}: </span>\r\n              {this.renderPhone()}\r\n            </div>\r\n          </div>\r\n        )}\r\n        {this.getRatePlan() && (\r\n          <div class=\"row p-0 m-0\">\r\n            <div class=\"px-0  col-12\">\r\n              <span class=\"font-weight-bold\">{locales.entries.Lcz_RatePlan}: </span>\r\n              {this.getRatePlan()}\r\n            </div>\r\n          </div>\r\n        )}\r\n        {this.renderNote()}\r\n        {this.getInternalNote() ? (\r\n          <div class=\"row p-0 m-0\">\r\n            <div class=\"col-12 px-0 text-wrap\">\r\n              {this.bookingEvent.is_direct ? (\r\n                <Fragment>\r\n                  <span class=\"font-weight-bold\">{locales.entries.Lcz_InternalRemark}: </span>\r\n                  {this.getInternalNote()}\r\n                </Fragment>\r\n              ) : (\r\n                <ota-label label={`${locales.entries.Lcz_InternalRemark}:`} remarks={this.bookingEvent.ota_notes}></ota-label>\r\n              )}\r\n            </div>\r\n          </div>\r\n        ) : null}\r\n\r\n        <div class=\"row p-0 m-0 mt-2\">\r\n          <div class=\"full-width btn-group  btn-group-sm font-small-3\" role=\"group\">\r\n            <button\r\n              type=\"button\"\r\n              class={`btn btn-primary d-flex align-items-center justify-content-center ${this.hideButtons ? 'mr-0' : 'mr-1'} ${this.shouldHideUnassignUnit ? 'w-50' : ''}`}\r\n              onClick={_ => {\r\n                this.handleEditBooking();\r\n              }}\r\n              disabled={!this.bookingEvent.IS_EDITABLE}\r\n            >\r\n              {/* <i class=\"ft ft-edit font-small-3\"></i> */}\r\n              <svg class=\"p-0 m-0\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" stroke=\"currentColor\" height=\"12\" width=\"12\" viewBox=\"0 0 512 512\">\r\n                <path\r\n                  fill=\"currentColor\"\r\n                  d=\"M471.6 21.7c-21.9-21.9-57.3-21.9-79.2 0L362.3 51.7l97.9 97.9 30.1-30.1c21.9-21.9 21.9-57.3 0-79.2L471.6 21.7zm-299.2 220c-6.1 6.1-10.8 13.6-13.5 21.9l-29.6 88.8c-2.9 8.6-.6 18.1 5.8 24.6s15.9 8.7 24.6 5.8l88.8-29.6c8.2-2.7 15.7-7.4 21.9-13.5L437.7 172.3 339.7 74.3 172.4 241.7zM96 64C43 64 0 107 0 160V416c0 53 43 96 96 96H352c53 0 96-43 96-96V320c0-17.7-14.3-32-32-32s-32 14.3-32 32v96c0 17.7-14.3 32-32 32H96c-17.7 0-32-14.3-32-32V160c0-17.7 14.3-32 32-32h96c17.7 0 32-14.3 32-32s-14.3-32-32-32H96z\"\r\n                />\r\n              </svg>\r\n              <span>\r\n                &nbsp;\r\n                {locales.entries.Lcz_Edit}\r\n              </span>\r\n            </button>\r\n            {this.bookingEvent.is_direct && this.bookingEvent.IS_EDITABLE && !this.hideButtons && (\r\n              <button\r\n                type=\"button\"\r\n                class={`btn btn-primary d-flex align-items-center justify-content-center ${!this.shouldHideUnassignUnit ? 'mr-1' : 'w-50'}`}\r\n                onClick={_ => {\r\n                  this.handleAddRoom();\r\n                }}\r\n              >\r\n                {/* <i class=\"ft ft-plus-circle font-small-3\"></i> */}\r\n                <svg class=\"p-0 m-0\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke-width=\"2\" stroke=\"currentColor\" height={12} width={12}>\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M12 9v6m3-3H9m12 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z\" />\r\n                </svg>\r\n                <span>&nbsp;{locales.entries.Lcz_AddRoom}</span>\r\n              </button>\r\n            )}\r\n            {/* {this.canCheckIn() ? (\r\n              <button\r\n                type=\"button\"\r\n                class=\"btn btn-primary p-0 mr-1\"\r\n                onClick={_ => {\r\n                  this.handleCustomerCheckIn();\r\n                }}\r\n                disabled={!this.bookingEvent.IS_EDITABLE}\r\n              >\r\n                <i class=\"ft ft-edit font-small-3\"></i> {locales.entries.Lcz_CheckIn}\r\n              </button>\r\n            ) : null}\r\n            {this.canCheckOut() ? (\r\n              <button\r\n                type=\"button\"\r\n                class=\"btn btn-primary p-0 mr-1\"\r\n                onClick={_ => {\r\n                  this.handleCustomerCheckOut();\r\n                }}\r\n                disabled={!this.bookingEvent.IS_EDITABLE}\r\n              >\r\n                <i class=\"ft ft-log-out font-small-3\"></i> {locales.entries.Lcz_CheckOut}\r\n              </button>\r\n            ) : null} */}\r\n\r\n            {this.hideButtons\r\n              ? null\r\n              : !this.shouldHideUnassignUnit && (\r\n                  <button\r\n                    type=\"button\"\r\n                    class=\"btn btn-primary p-0 d-flex align-items-center justify-content-center\"\r\n                    onClick={_ => {\r\n                      this.handleDeleteEvent();\r\n                    }}\r\n                    disabled={!this.bookingEvent.IS_EDITABLE || this.is_vacation_rental}\r\n                  >\r\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"12\" width=\"8.75\" class=\"p-0 m-0\" viewBox=\"0 0 384 512\">\r\n                      <path\r\n                        fill=\"currentColor\"\r\n                        d=\"M342.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 210.7 86.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L146.7 256 41.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 301.3 297.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L237.3 256 342.6 150.6z\"\r\n                      />\r\n                    </svg>\r\n                    <span class=\"m-0 p-0\">&nbsp;{locales.entries.Lcz_Unassign}</span>\r\n                  </button>\r\n                )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  getNewBookingOptions() {\r\n    const shouldDisplayButtons = this.bookingEvent.roomsInfo[0].rateplans.some(rate => rate.is_active);\r\n    return (\r\n      <div class={`iglPopOver newBookingOptions ${this.bubbleInfoTop ? 'bubbleInfoAbove' : ''} text-left`}>\r\n        {shouldDisplayButtons ? (\r\n          <Fragment>\r\n            <button\r\n              type=\"button\"\r\n              class=\"d-block full-width btn btn-sm btn-primary mb-1 font-small-3 square\"\r\n              onClick={_ => {\r\n                this.handleBookingOption('BAR_BOOKING');\r\n              }}\r\n            >\r\n              {locales.entries.Lcz_CreateNewBooking}\r\n            </button>\r\n            {this.hasSplitBooking() ? (\r\n              <button\r\n                type=\"button\"\r\n                class=\"d-block full-width btn btn-sm btn-primary mb-1 font-small-3 square\"\r\n                onClick={_ => {\r\n                  this.handleBookingOption('SPLIT_BOOKING');\r\n                }}\r\n              >\r\n                {locales.entries.Lcz_AssignUnitToExistingBooking}\r\n              </button>\r\n            ) : null}\r\n          </Fragment>\r\n        ) : (\r\n          <p class={'text-danger'}>{locales.entries.Lcz_NoRatePlanDefined}</p>\r\n        )}\r\n        <button\r\n          type=\"button\"\r\n          class=\"d-block full-width btn btn-sm btn-primary font-small-3 square\"\r\n          onClick={_ => {\r\n            this.handleBookingOption('BLOCK_DATES');\r\n          }}\r\n        >\r\n          {locales.entries.Lcz_Blockdates}\r\n        </button>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  getBlockedView() {\r\n    // let defaultData = {RELEASE_AFTER_HOURS: 0, OPTIONAL_REASON: \"\", OUT_OF_SERVICE: false};\r\n    return (\r\n      <div class={`iglPopOver blockedView ${this.bubbleInfoTop ? 'bubbleInfoAbove' : ''} text-left`}>\r\n        <igl-block-dates-view\r\n          isEventHover={true}\r\n          entryHour={this.bookingEvent.ENTRY_HOUR}\r\n          entryMinute={this.bookingEvent.ENTRY_MINUTE}\r\n          defaultData={this.bookingEvent}\r\n          fromDate={moment(this.bookingEvent.FROM_DATE, 'YYYY-MM-DD').format('DD MM YYYY')}\r\n          toDate={moment(this.bookingEvent.TO_DATE, 'YYYY-MM-DD').format('DD MM YYYY')}\r\n          entryDate={this.getEntryDate()}\r\n          onDataUpdateEvent={event => this.handleBlockDateUpdate(event)}\r\n        ></igl-block-dates-view>\r\n        <div class=\"row p-0 m-0 mt-2\">\r\n          <div class=\"full-width btn-group btn-group-sm font-small-3\" role=\"group\">\r\n            <button\r\n              disabled={this.isLoading === 'update'}\r\n              type=\"button\"\r\n              class=\"btn btn-primary mr-1 d-flex align-items-center justify-content-center\"\r\n              onClick={_ => {\r\n                this.handleUpdateBlockedDates();\r\n              }}\r\n            >\r\n              {this.isLoading === 'update' ? (\r\n                <i class=\"la la-circle-o-notch spinner mx-1\"></i>\r\n              ) : (\r\n                <svg class=\"p-0 m-0\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" stroke=\"currentColor\" height=\"12\" width=\"12\" viewBox=\"0 0 512 512\">\r\n                  <path\r\n                    fill=\"currentColor\"\r\n                    d=\"M471.6 21.7c-21.9-21.9-57.3-21.9-79.2 0L362.3 51.7l97.9 97.9 30.1-30.1c21.9-21.9 21.9-57.3 0-79.2L471.6 21.7zm-299.2 220c-6.1 6.1-10.8 13.6-13.5 21.9l-29.6 88.8c-2.9 8.6-.6 18.1 5.8 24.6s15.9 8.7 24.6 5.8l88.8-29.6c8.2-2.7 15.7-7.4 21.9-13.5L437.7 172.3 339.7 74.3 172.4 241.7zM96 64C43 64 0 107 0 160V416c0 53 43 96 96 96H352c53 0 96-43 96-96V320c0-17.7-14.3-32-32-32s-32 14.3-32 32v96c0 17.7-14.3 32-32 32H96c-17.7 0-32-14.3-32-32V160c0-17.7 14.3-32 32-32h96c17.7 0 32-14.3 32-32s-14.3-32-32-32H96z\"\r\n                  />\r\n                </svg>\r\n              )}\r\n              <span>\r\n                &nbsp;\r\n                {locales.entries.Lcz_Update}\r\n              </span>\r\n            </button>\r\n            <button\r\n              type=\"button\"\r\n              class=\"btn btn-primary\"\r\n              onClick={_ => {\r\n                this.handleConvertBlockedDateToBooking();\r\n              }}\r\n            >\r\n              {locales.entries.Lcz_ConvertToBooking}\r\n            </button>\r\n            <button\r\n              type=\"button\"\r\n              class=\"btn btn-danger ml-1 d-flex align-items-center justify-content-center\"\r\n              onClick={_ => {\r\n                this.handleDeleteEvent();\r\n              }}\r\n            >\r\n              {/* <i class=\"ft ft-trash-2 font-small-3\"></i> */}\r\n              <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"12\" width=\"10.5\" viewBox=\"0 0 448 512\">\r\n                <path\r\n                  fill=\"currentColor\"\r\n                  d=\"M135.2 17.7C140.6 6.8 151.7 0 163.8 0H284.2c12.1 0 23.2 6.8 28.6 17.7L320 32h96c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 96 0 81.7 0 64S14.3 32 32 32h96l7.2-14.3zM32 128H416V448c0 35.3-28.7 64-64 64H96c-35.3 0-64-28.7-64-64V128zm96 64c-8.8 0-16 7.2-16 16V432c0 8.8 7.2 16 16 16s16-7.2 16-16V208c0-8.8-7.2-16-16-16zm96 0c-8.8 0-16 7.2-16 16V432c0 8.8 7.2 16 16 16s16-7.2 16-16V208c0-8.8-7.2-16-16-16zm96 0c-8.8 0-16 7.2-16 16V432c0 8.8 7.2 16 16 16s16-7.2 16-16V208c0-8.8-7.2-16-16-16z\"\r\n                />\r\n              </svg>\r\n              <span>\r\n                &nbsp;\r\n                {locales.entries.Lcz_Delete}\r\n              </span>\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <Host>\r\n        <div class={`pointerContainer ${this.bubbleInfoTop ? 'pointerContainerTop' : ''}`}>\r\n          <div class={`bubblePointer ${this.bubbleInfoTop ? 'bubblePointTop' : 'bubblePointBottom'}`}></div>\r\n        </div>\r\n        {this.isBlockedDateEvent() ? this.getBlockedView() : null}\r\n        {this.isNewBooking() ? this.getNewBookingOptions() : null}\r\n        {!this.isBlockedDateEvent() && !this.isNewBooking() ? this.getInfoElement() : null}\r\n      </Host>\r\n    );\r\n  }\r\n}\r\n",":host {\r\n  display: block;\r\n  width: 100%;\r\n}\r\n* {\r\n  box-sizing: border-box;\r\n}\r\n.popover-title {\r\n  position: relative;\r\n  width: 100%;\r\n  height: 100%;\r\n  margin: 0;\r\n  padding: 0;\r\n  white-space: nowrap;\r\n  overflow: hidden;\r\n  text-overflow: ellipsis;\r\n  z-index: 10;\r\n  left: 0;\r\n}\r\n.popover-container {\r\n  position: absolute;\r\n  bottom: 0px;\r\n  left: var(--ir-popover-left, 10px);\r\n  background: rgb(0, 0, 0);\r\n  color: white;\r\n  min-width: 100%;\r\n  box-shadow: rgba(0, 0, 0, 0.2) 0px 2px 10px;\r\n  z-index: 9999;\r\n  padding: 3.5px 7px;\r\n  border-radius: 5px;\r\n  pointer-events: none;\r\n  opacity: 0;\r\n  transition: all 100ms ease;\r\n  font-family: 'Open Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\r\n  font-style: normal;\r\n  font-weight: 400;\r\n  line-height: 1.45;\r\n  text-decoration: none;\r\n  text-shadow: none;\r\n  font-size: 0.875rem;\r\n}\r\n.popover-container[data-state='show'] {\r\n  opacity: 1;\r\n}\r\n","import { Component, Host, Prop, State, h, Element } from '@stencil/core';\r\n\r\n@Component({\r\n  tag: 'ir-popover',\r\n  styleUrl: 'ir-popover.css',\r\n  scoped: true,\r\n})\r\nexport class IrPopover {\r\n  @Element() el: HTMLElement;\r\n  @Prop() popoverTitle: string;\r\n  @State() isHovered: boolean = false;\r\n  @State() showPopover: boolean = false;\r\n  @Prop() irPopoverLeft: string = '10px';\r\n\r\n  componentWillLoad() {\r\n    this.checkTitleWidth();\r\n  }\r\n  handleMouseEnter = () => {\r\n    if (!this.showPopover) {\r\n      return;\r\n    }\r\n    if (this.showPopover) {\r\n      this.isHovered = true;\r\n    }\r\n  };\r\n\r\n  handleMouseLeave = () => {\r\n    if (!this.showPopover) {\r\n      return;\r\n    }\r\n    this.isHovered = false;\r\n  };\r\n\r\n  checkTitleWidth() {\r\n    requestAnimationFrame(() => {\r\n      const titleElement = this.el.querySelector('.popover-title');\r\n      if (titleElement) {\r\n        const width = titleElement.scrollWidth;\r\n        this.showPopover = width > 150; // Show popover if title width exceeds 170px\r\n      }\r\n    });\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <Host style={{ '--ir-popover-left': this.irPopoverLeft }}>\r\n        <p class=\"popover-title\" onMouseLeave={this.handleMouseLeave} onMouseEnter={this.handleMouseEnter}>\r\n          {this.popoverTitle}\r\n        </p>\r\n        {this.showPopover && this.isHovered && (\r\n          <div data-state=\"show\" class=\"popover-container\">\r\n            {this.popoverTitle}\r\n          </div>\r\n        )}\r\n      </Host>\r\n    );\r\n  }\r\n}\r\n"],"mappings":"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"}