import{r as t,h as s,H as e,g as i}from"./p-1da6dd41.js";import{H as a,u as l,h as n}from"./p-f2b2d224.js";import{R as h}from"./p-c4e830f9.js";import{l as r}from"./p-cda0b50c.js";import{a as c}from"./p-54928856.js";import"./p-58003fb6.js";import"./p-a7b295ee.js";const o=".sc-ir-hk-tasks-h{display:block}.checkbox-container.sc-ir-hk-tasks{display:flex;align-items:center;justify-content:center}.table-container.sc-ir-hk-tasks{overflow-x:auto;max-width:100%;width:max-content}.table.sc-ir-hk-tasks,th.sc-ir-hk-tasks,td.sc-ir-hk-tasks{border-color:white !important}.select-container.sc-ir-hk-tasks{max-width:500px}@media only screen and (min-width: 900px){td.sc-ir-hk-tasks{min-width:140px !important;width:max-content !important}}@media only screen and (max-width: 900px){td.sc-ir-hk-tasks{min-width:100px !important}.table-container.sc-ir-hk-tasks{width:max-content !important}}";const d=class{constructor(s){t(this,s);this.roomService=new h;this.houseKeepingService=new a;this.language="";this.ticket="";this.baseurl="";this.propertyid=undefined;this.isLoading=false;this.selectedDuration="";this.selectedHouseKeeper="0";this.selectedRoom=null;this.archiveOpened=false}componentWillLoad(){if(this.baseurl){c.defaults.baseURL=this.baseurl}if(this.ticket!==""){this.roomService.setToken(this.ticket);this.houseKeepingService.setToken(this.ticket);l("default_properties",{token:this.ticket,property_id:this.propertyid,language:this.language});this.initializeApp()}}async handleResetData(t){t.stopImmediatePropagation();t.stopPropagation();const{arrival:s,arrival_time:e,housekeeper:i,unit:a,status:l}=this.selectedRoom;this.houseKeepingService.executeHKAction({property_id:this.propertyid,arrival:s,arrival_time:e,housekeeper:{id:i.id},status:{code:l.code},unit:{id:a.id}});await this.houseKeepingService.getExposedHKSetup(this.propertyid)}async ticketChanged(t,s){if(t!==s){this.roomService.setToken(this.ticket);this.houseKeepingService.setToken(this.ticket);l("default_properties",{token:this.ticket,property_id:this.propertyid,language:this.language});this.initializeApp()}}handleCheckChange(t,s){if(t.detail){this.selectedRoom=s;this.modalOpenTimeOut=setTimeout((()=>{const t=this.el.querySelector("ir-modal");if(t){t.openModal()}}),50)}}handleCloseSidebar(t){t.stopImmediatePropagation();t.stopPropagation();this.archiveOpened=false}disconnectedCallback(){if(this.modalOpenTimeOut){clearTimeout(this.modalOpenTimeOut)}}async getPendingActions(){await this.houseKeepingService.getHKPendingActions({property_id:this.propertyid,bracket:{code:this.selectedDuration},housekeeper:{id:+this.selectedHouseKeeper}})}async initializeApp(){try{this.isLoading=true;await Promise.all([this.houseKeepingService.getExposedHKStatusCriteria(this.propertyid),this.roomService.fetchData(this.propertyid,this.language),this.roomService.fetchLanguage(this.language,["_HK_FRONT"])]);this.selectedDuration=n.hk_tasks.brackets[0].code;await this.getPendingActions()}catch(t){console.error(t)}finally{this.isLoading=false}}async handleConfirm(t){t.preventDefault();t.stopImmediatePropagation();t.stopPropagation();try{await this.getPendingActions()}catch(t){console.error(t)}finally{this.selectedRoom=null}}render(){var t;if(this.isLoading){return s("ir-loading-screen",null)}return s(e,null,s("ir-toast",null),s("ir-interceptor",null),s("section",{class:"p-2"},s("ir-title",{class:"d-none d-md-flex",label:r.entries.Lcz_HousekeepingTasks,justifyContent:"space-between"},s("ir-button",{slot:"title-body",text:r.entries.Lcz_Archive,size:"sm"})),s("div",{class:"d-flex align-items-center mb-2 justify-content-between d-md-none"},s("ir-title",{class:"mb-0",label:r.entries.Lcz_HousekeepingTasks,justifyContent:"space-between"}),s("ir-button",{slot:"title-body",text:r.entries.Lcz_Archive,size:"sm",onClickHanlder:()=>this.archiveOpened=true})),s("div",{class:"d-flex flex-column flex-sm-row align-items-center mb-1  select-container"},s("ir-select",{selectedValue:this.selectedDuration,onSelectChange:t=>{this.selectedDuration=t.detail;this.getPendingActions()},data:n.hk_tasks.brackets.map((t=>({text:t.description,value:t.code}))),class:"mb-1 w-100 mb-sm-0",showFirstOption:false,LabelAvailable:false}),s("ir-select",{onSelectChange:t=>{this.selectedHouseKeeper=t.detail;this.getPendingActions()},selectedValue:this.selectedHouseKeeper,data:[{text:"All housekeepers",value:"0"},...n.hk_tasks.housekeepers.map((t=>({text:t.name,value:t.id.toString()})))],showFirstOption:false,LabelAvailable:false,class:"ml-sm-2 w-100"})),s("div",{class:"card p-1"},s("div",{class:"table-container"},s("table",{class:"table"},s("thead",null,s("tr",null,s("th",{class:"text-left"},r.entries.Lcz_Unit),s("th",{class:"text-left"},r.entries.Lcz_Status),s("th",{class:"text-left"},r.entries.Lcz_Arrivaldate),s("th",{class:"text-left"},r.entries.Lcz_ArrivalTime),s("th",{class:"text-left"},r.entries.Lcz_Housekeeper),s("th",{class:"text-center"},r.entries.Lcz_Done))),s("tbody",null,(t=n.pending_housekeepers)===null||t===void 0?void 0:t.map((t=>{var e;return s("tr",{key:t.housekeeper.id},s("td",{class:"text-left"},t.unit.name),s("td",{class:"text-left"},t.status.description),s("td",{class:"text-left"},t.arrival),s("td",{class:"text-left"},t.arrival_time),s("td",{class:"text-left"},t.housekeeper.name),s("td",null,s("div",{class:"checkbox-container"},s("ir-checkbox",{onCheckChange:s=>this.handleCheckChange(s,t),checked:((e=this.selectedRoom)===null||e===void 0?void 0:e.unit.id)===t.unit.id}))))}))))))),this.selectedRoom&&s("ir-modal",{leftBtnText:r.entries.Lcz_No,rightBtnText:r.entries.Lcz_Yes,onConfirmModal:this.handleConfirm.bind(this),onCancelModal:()=>this.selectedRoom=null,modalBody:`Is ${this.selectedRoom.unit.name} cleaned?`}))}get el(){return i(this)}static get watchers(){return{ticket:["ticketChanged"]}}};d.style=o;export{d as ir_hk_tasks};
//# sourceMappingURL=p-3056244b.entry.js.map